CREATE or ALTER  PROCEDURE GESTION_CREATION_DOMAINE1
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( select RDB$FIELD_NAME from RDB$FIELDS where RDB$FIELD_NAME = 'DLIB_COMMENTAIRE')) THEN
query = 'CREATE DOMAIN DLIB_COMMENTAIRE AS VARCHAR(2000)';

IF (:query<>'')then EXECUTE STATEMENT :query;

END
^

EXECUTE PROCEDURE GESTION_CREATION_DOMAINE1
^
drop procedure GESTION_CREATION_DOMAINE1
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER1
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_L_AVOIR_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_L_AVOIR_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER1
^
drop procedure GESTION_DROP_TRIGGER1
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER2
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_L_BONCDE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_L_BONCDE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER2
^
drop procedure GESTION_DROP_TRIGGER2
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER3
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_L_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_L_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER3
^
drop procedure GESTION_DROP_TRIGGER3
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER4
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_L_DEVIS_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_L_DEVIS_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER4
^
drop procedure GESTION_DROP_TRIGGER4
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER5
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_L_FACTURE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_L_FACTURE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER5
^
drop procedure GESTION_DROP_TRIGGER5
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER6
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_AVOIR_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_AVOIR_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER6
^
drop procedure GESTION_DROP_TRIGGER6
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER7
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_BONCDE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_BONCDE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER7
^
drop procedure GESTION_DROP_TRIGGER7
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER8
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER8
^
drop procedure GESTION_DROP_TRIGGER8
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER9
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_DEVIS_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_DEVIS_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER9
^
drop procedure GESTION_DROP_TRIGGER9
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER10
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_FACTURE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_FACTURE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER10
^
drop procedure GESTION_DROP_TRIGGER10
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER11
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_DEVIS_ETRANGER')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_DEVIS_ETRANGER';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER11
^
drop procedure GESTION_DROP_TRIGGER11
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER12
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_L_FACTURE_ETRANGER')) THEN
  begin
    query = 'DROP TRIGGER TBUID_L_FACTURE_ETRANGER';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER12
^
drop procedure GESTION_DROP_TRIGGER12
^


CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER13
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_AVOIR_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_AVOIR_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER13
^
drop procedure GESTION_DROP_TRIGGER13
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER14
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_BONCDE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_BONCDE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER14
^
drop procedure GESTION_DROP_TRIGGER14
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER15
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER15
^
drop procedure GESTION_DROP_TRIGGER15
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER16
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_DEVIS_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_DEVIS_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER16
^
drop procedure GESTION_DROP_TRIGGER16
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER17
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_FACTURE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_FACTURE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER17
^
drop procedure GESTION_DROP_TRIGGER17
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER18
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_AVOIR_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_AVOIR_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER18
^
drop procedure GESTION_DROP_TRIGGER18
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER19
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_BONCDE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_BONCDE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER19
^
drop procedure GESTION_DROP_TRIGGER19
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER20
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER20
^
drop procedure GESTION_DROP_TRIGGER20
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER21
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_DEVIS_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_DEVIS_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER21
^
drop procedure GESTION_DROP_TRIGGER21
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER22
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_FACTURE_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_FACTURE_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER22
^
drop procedure GESTION_DROP_TRIGGER22
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER23
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_DEVIS_ETRANGER')) THEN
  begin
    query = 'DROP TRIGGER TBUID_DEVIS_ETRANGER';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER23
^
drop procedure GESTION_DROP_TRIGGER23
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER24
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_FACTURE_ETRANGER')) THEN
  begin
    query = 'DROP TRIGGER TBUID_FACTURE_ETRANGER';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER24
^
drop procedure GESTION_DROP_TRIGGER24
^


CREATE or ALTER  PROCEDURE GESTION_DROP_VIEW1
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$VIEW_NAME
FROM RDB$VIEW_RELATIONS a
where a.RDB$VIEW_NAME = 'V_R_DOCUMENT')) THEN
  begin
    query = 'DROP VIEW V_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_VIEW1 
^
drop procedure GESTION_DROP_VIEW1
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION1
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKID_DEVIS')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKID_DEVIS ''Ce devis n''''existe pas !''';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION1 
^
drop procedure GESTION_CREATION_EXCEPTION1
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION2
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKID_BONLIV')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKID_BONLIV ''Ce bon de livraison n''''existe pas !''';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION2 
^
drop procedure GESTION_CREATION_EXCEPTION2
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION3
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKID_BONCDE')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKID_BONCDE ''Ce bon de commande n''''existe pas !''';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION3 
^
drop procedure GESTION_CREATION_EXCEPTION3
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION4
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKID_AVOIR')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKID_AVOIR ''Cet avoir n''''existe pas !''';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION4 
^
drop procedure GESTION_CREATION_EXCEPTION4
^


CREATE OR ALTER TRIGGER TBI_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 2
as
begin
   /*If (New.ID_R_DOCUMENT  is null) Then
      New.ID_R_DOCUMENT  = GEN_ID(NUM_ID_R_DOCUMENT,1);
   New.QUI_CREE_R_DOCUMENT  = USER;
   New.QUAND_CREE_R_DOCUMENT = 'NOW';
   New.QUI_MODIF_R_DOCUMENT = USER;
   New.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";*/
end
^



CREATE OR ALTER TRIGGER TBU_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   /*new.QUI_MODIF_R_DOCUMENT = USER;
   new.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";*/
end
^


CREATE OR ALTER PROCEDURE MAJ_GENERATEUR 
AS
DECLARE VARIABLE V_GEN INTEGER;
DECLARE VARIABLE V_MAX INTEGER;
BEGIN
EXIT;
END
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE1
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_FACTURE ' and  a.RDB$FIELD_NAME ='COMMENTAIRE')) THEN
  begin
    query = 'ALTER TABLE TA_FACTURE  ADD COMMENTAIRE DLIB_COMMENTAIRE ,alter COMMENTAIRE position 20';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE1
^
drop procedure GESTION_CREATION_TABLE1
^




CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE2
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_R_DOCUMENT')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_R_DOCUMENT DID3 NOT NULL,alter ID_R_DOCUMENT position 1';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE2
^
drop procedure GESTION_CREATION_TABLE2
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE3
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_FACTURE')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_FACTURE DID_FACULTATIF ,alter ID_FACTURE position 2';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE3
^
drop procedure GESTION_CREATION_TABLE3
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE4
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_DEVIS DID_FACULTATIF ,alter ID_DEVIS position 3';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE4
^
drop procedure GESTION_CREATION_TABLE4
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE5
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_BONCDE')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_BONCDE DID_FACULTATIF ,alter ID_BONCDE position 4';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE5
^
drop procedure GESTION_CREATION_TABLE5
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE6
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_AVOIR')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_AVOIR DID_FACULTATIF ,alter ID_AVOIR position 5';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE6
^
drop procedure GESTION_CREATION_TABLE6
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE7
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_R_DOCUMENT ' and  a.RDB$FIELD_NAME ='ID_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_R_DOCUMENT  ADD ID_BONLIV DID_FACULTATIF ,alter ID_BONLIV position 5';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE7
^
drop procedure GESTION_CREATION_TABLE7
^

CREATE OR ALTER TRIGGER TBIID_AVOIR_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_AVOIR is not null) then
       begin
       select count(*) from TA_AVOIR
       where ID_AVOIR= NEW.ID_AVOIR
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_l_AVOIR;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_BONCDE_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_BONCDE is not null) then
       begin
       select count(*) from TA_BONCDE
       where ID_BONCDE= NEW.ID_BONCDE
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_BONCDE;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_BONLIV is not null) then
       begin
       select count(*) from TA_BONLIV
       where ID_BONLIV= NEW.ID_BONLIV
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_BONLIV;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_DEVIS_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_DEVIS is not null) then
       begin
       select count(*) from TA_DEVIS
       where ID_DEVIS= NEW.ID_DEVIS
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_DEVIS;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_FACTURE_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_FACTURE is not null) then
       begin
       select count(*) from TA_FACTURE
       where ID_FACTURE= NEW.ID_FACTURE
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_FACTURE;
       end   
end
^


CREATE OR ALTER TRIGGER TBI_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 2
as
begin
   If (New.ID_R_DOCUMENT  is null) Then
      New.ID_R_DOCUMENT  = GEN_ID(NUM_ID_R_DOCUMENT,1);
   New.QUI_CREE_R_DOCUMENT  = USER;
   New.QUAND_CREE_R_DOCUMENT = 'NOW';
   New.QUI_MODIF_R_DOCUMENT = USER;
   New.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBUID_AVOIR_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_AVOIR <> NEW.ID_AVOIR)) then
   begin
     select count(*) from TA_AVOIR
     where ID_AVOIR = NEW.ID_AVOIR
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_AVOIR;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_BONCDE_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_BONCDE <> NEW.ID_BONCDE)) then
   begin
     select count(*) from TA_BONCDE
     where ID_BONCDE = NEW.ID_BONCDE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_BONCDE;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_BONLIV <> NEW.ID_BONLIV)) then
   begin
     select count(*) from TA_BONLIV
     where ID_BONLIV = NEW.ID_BONLIV
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_BONLIV;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_DEVIS_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_DEVIS <> NEW.ID_DEVIS)) then
   begin
     select count(*) from TA_DEVIS
     where ID_DEVIS = NEW.ID_DEVIS
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_DEVIS;
   end
end
^



CREATE OR ALTER TRIGGER TBUID_FACTURE_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_FACTURE <> NEW.ID_FACTURE)) then
   begin
     select count(*) from TA_FACTURE
     where ID_FACTURE = NEW.ID_FACTURE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_FACTURE;
   end
end
^



CREATE OR ALTER TRIGGER TBU_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   new.QUI_MODIF_R_DOCUMENT = USER;
   new.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBUID_DEVIS_ETRANGER FOR TA_DEVIS
ACTIVE AFTER DELETE POSITION 1
as
begin
delete from TA_R_DOCUMENT where old.id_DEVIS = id_DEVIS;
end
^

CREATE OR ALTER TRIGGER TBUID_FACTURE_ETRANGER FOR TA_FACTURE
ACTIVE AFTER DELETE POSITION 1
as
begin
delete from TA_R_DOCUMENT where old.id_FACTURE = id_FACTURE;
end
^


CREATE OR ALTER TRIGGER TBI_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 2
as
begin
   If (New.ID_R_DOCUMENT  is null) Then
      New.ID_R_DOCUMENT  = GEN_ID(NUM_ID_R_DOCUMENT,1);
   New.QUI_CREE_R_DOCUMENT  = USER;
   New.QUAND_CREE_R_DOCUMENT = 'NOW';
   New.QUI_MODIF_R_DOCUMENT = USER;
   New.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^



CREATE OR ALTER TRIGGER TBU_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   new.QUI_MODIF_R_DOCUMENT = USER;
   new.QUAND_MODIF_R_DOCUMENT = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION5
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKID_DEVIS')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKID_DEVIS ''Ce devis n''existe pas !''';
    EXECUTE STATEMENT :query;
  end
END
^

EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION5 
^
drop procedure GESTION_CREATION_EXCEPTION5
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_EXCEPTION6
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKCODE_DEVIS')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKCODE_DEVIS ''Le code devis doit être unique''';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_EXCEPTION6 
^
drop procedure GESTION_CREATION_EXCEPTION6
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE8
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='CODE_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD CODE_DEVIS DLGR_CODE,alter CODE_DEVIS position 2';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE8 
^
drop procedure GESTION_CREATION_TABLE8
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE9
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='DATE_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD DATE_DEVIS TIMESTAMP DEFAULT ''NOW'',alter DATE_DEVIS position 3';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE9 
^
drop procedure GESTION_CREATION_TABLE9
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE10
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='DATE_ECH_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD DATE_ECH_DEVIS TIMESTAMP DEFAULT ''NOW'',alter DATE_ECH_DEVIS position 4';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE10 
^
drop procedure GESTION_CREATION_TABLE10
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE11
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='DATE_LIV_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD DATE_LIV_DEVIS TIMESTAMP DEFAULT ''NOW'',alter DATE_LIV_DEVIS position 5';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE11 
^
drop procedure GESTION_CREATION_TABLE11
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE12
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='LIBELLE_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD LIBELLE_DEVIS DLIB255NN,alter LIBELLE_DEVIS position 6';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE12 
^
drop procedure GESTION_CREATION_TABLE12
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE13
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='ID_ADRESSE')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD ID_ADRESSE DID_FACULTATIF,alter ID_ADRESSE position 7';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE13 
^
drop procedure GESTION_CREATION_TABLE13
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE14
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='ID_ADRESSE_LIV')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD ID_ADRESSE_LIV DID_FACULTATIF,alter ID_ADRESSE_LIV position 8';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE14 
^
drop procedure GESTION_CREATION_TABLE14
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE15
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='ID_TIERS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD ID_TIERS DID3,alter ID_TIERS position 9';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE15 
^
drop procedure GESTION_CREATION_TABLE15
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE16
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='ID_T_PAIEMENT')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD ID_T_PAIEMENT DID_FACULTATIF,alter ID_T_PAIEMENT position 10';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE16 
^
drop procedure GESTION_CREATION_TABLE16
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE17
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='ID_C_PAIEMENT')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD ID_C_PAIEMENT DID_FACULTATIF,alter ID_C_PAIEMENT position 11';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE17 
^
drop procedure GESTION_CREATION_TABLE17
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE18
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='REM_HT_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD REM_HT_DEVIS DID9 DEFAULT 0,alter REM_HT_DEVIS position 12';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE18 
^
drop procedure GESTION_CREATION_TABLE18
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE19
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='TX_REM_HT_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD TX_REM_HT_DEVIS DID9 DEFAULT 0,alter TX_REM_HT_DEVIS position 13';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE19 
^
drop procedure GESTION_CREATION_TABLE19
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE20
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='REM_TTC_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD REM_TTC_DEVIS DID9 DEFAULT 0,alter REM_TTC_DEVIS position 14';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE20 
^
drop procedure GESTION_CREATION_TABLE20
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE21
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='TX_REM_TTC_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD TX_REM_TTC_DEVIS DID9 DEFAULT 0,alter TX_REM_TTC_DEVIS position 15';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE21 
^
drop procedure GESTION_CREATION_TABLE21
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE22
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='NB_E_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD NB_E_DEVIS DID4,alter NB_E_DEVIS position 16';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE22 
^
drop procedure GESTION_CREATION_TABLE22
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE23
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='TTC')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD TTC DBOOL,alter TTC position 17';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE23 
^
drop procedure GESTION_CREATION_TABLE23
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE24
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='EXPORT')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD EXPORT DBOOL,alter EXPORT position 18';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE24 
^
drop procedure GESTION_CREATION_TABLE24
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE25
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_DEVIS' and  a.RDB$FIELD_NAME ='COMMENTAIRE')) THEN
  begin
    query = 'ALTER TABLE TA_DEVIS ADD COMMENTAIRE DLIB_COMMENTAIRE,alter COMMENTAIRE position 19';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE25 
^
drop procedure GESTION_CREATION_TABLE25
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE26
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='ID_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD ID_DEVIS DID3,alter ID_DEVIS position 1';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE26 
^
drop procedure GESTION_CREATION_TABLE26
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE27
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='ID_T_LIGNE')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD ID_T_LIGNE DID3,alter ID_T_LIGNE position 2';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE27 
^
drop procedure GESTION_CREATION_TABLE27
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE28
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='ID_ARTICLE')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD ID_ARTICLE DID4,alter ID_ARTICLE position 3';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE28 
^
drop procedure GESTION_CREATION_TABLE28
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE29
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='NUM_LIGNE_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD NUM_LIGNE_L_DEVIS DID3,alter NUM_LIGNE_L_DEVIS position 4';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE29 
^
drop procedure GESTION_CREATION_TABLE29
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE30
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='LIB_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD LIB_L_DEVIS DLIB255,alter LIB_L_DEVIS position 5';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE30 
^
drop procedure GESTION_CREATION_TABLE30
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE31
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='QTE_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD QTE_L_DEVIS DID9FACULT,alter QTE_L_DEVIS position 6';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE31 
^
drop procedure GESTION_CREATION_TABLE31
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE32
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='U1_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD U1_L_DEVIS DLIB20,alter U1_L_DEVIS position 7';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE32 
^
drop procedure GESTION_CREATION_TABLE32
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE33
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='U2_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD U2_L_DEVIS DLIB20,alter U2_L_DEVIS position 8';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE33 
^
drop procedure GESTION_CREATION_TABLE33
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE34
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='PRIX_U_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD PRIX_U_L_DEVIS DID9FACULT,alter PRIX_U_L_DEVIS position 9';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE34 
^
drop procedure GESTION_CREATION_TABLE34
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE35
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='TAUX_TVA_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD TAUX_TVA_L_DEVIS DLONG,alter TAUX_TVA_L_DEVIS position 10';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE35 
^
drop procedure GESTION_CREATION_TABLE35
^




CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE36
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='COMPTE_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD COMPTE_L_DEVIS DLIB8,alter COMPTE_L_DEVIS position 11';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE36 
^
drop procedure GESTION_CREATION_TABLE36
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE37
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='CODE_TVA_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD CODE_TVA_L_DEVIS DLIB20,alter CODE_TVA_L_DEVIS position 12';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE37 
^
drop procedure GESTION_CREATION_TABLE37
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE38
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='CODE_T_TVA_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD CODE_T_TVA_L_DEVIS DLIB1L,alter CODE_T_TVA_L_DEVIS position 13';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE38 
^
drop procedure GESTION_CREATION_TABLE38
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE39
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='MT_HT_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD MT_HT_L_DEVIS DID9FACULT,alter MT_HT_L_DEVIS position 14';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE39 
^
drop procedure GESTION_CREATION_TABLE39
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE40
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='MT_TTC_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD MT_TTC_L_DEVIS DID9FACULT,alter MT_TTC_L_DEVIS position 15';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE40 
^
drop procedure GESTION_CREATION_TABLE40
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE41
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='REM_TX_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD REM_TX_L_DEVIS DID9FACULT,alter REM_TX_L_DEVIS position 16';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE41 
^
drop procedure GESTION_CREATION_TABLE41
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE42
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_DEVIS' and  a.RDB$FIELD_NAME ='REM_HT_L_DEVIS')) THEN
  begin
    query = 'ALTER TABLE TA_L_DEVIS ADD REM_HT_L_DEVIS DID9FACULT,alter REM_HT_L_DEVIS position 17';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE42 
^
drop procedure GESTION_CREATION_TABLE42
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_INDEX
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$INDEX_NAME, a.RDB$RELATION_NAME
FROM RDB$INDICES a where a.RDB$RELATION_NAME = 'TA_L_DEVIS'
and a.RDB$INDEX_NAME='TA_L_DEVIS_ID_DEVIS')) THEN
  begin
    query = 'CREATE INDEX TA_L_DEVIS_ID_DEVIS ON TA_L_DEVIS (ID_DEVIS)';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_INDEX 
^
drop procedure GESTION_CREATION_INDEX
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_INDEX
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$INDEX_NAME, a.RDB$RELATION_NAME
FROM RDB$INDICES a where a.RDB$RELATION_NAME = 'TA_L_DEVIS'
and a.RDB$INDEX_NAME='TA_L_DEVIS_ID_T_LIGNE')) THEN
  begin
    query = 'CREATE INDEX TA_L_DEVIS_ID_T_LIGNE ON TA_L_DEVIS (ID_T_LIGNE)';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_INDEX 
^
drop procedure GESTION_CREATION_INDEX
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE43
as    
DECLARE VARIABLE QUERY VARCHAR(5000);
BEGIN
query = '';
IF (not exists( SELECT  a.RDB$RELATION_NAME
FROM RDB$RELATIONS a
where a.RDB$RELATION_NAME='TA_L_DEVIS_TEMP')) THEN
  begin
    query = 'CREATE TABLE TA_L_DEVIS_TEMP (
    ID_L_DEVIS           DID3 ,
    ID_DEVIS             DID3 ,
    ID_T_LIGNE           DID3 ,
    ID_ARTICLE           DID4 ,
    NUM_LIGNE_L_DEVIS    DID3 ,
    LIB_L_DEVIS          DLIB255 ,
    QTE_L_DEVIS          DID9FACULT ,
    U1_L_DEVIS           DLIB20 ,
    U2_L_DEVIS           DLIB20 ,
    PRIX_U_L_DEVIS       DID9FACULT ,
    TAUX_TVA_L_DEVIS     DLONG ,
    COMPTE_L_DEVIS       DLIB8 ,
    CODE_TVA_L_DEVIS     DLIB20 ,
    CODE_T_TVA_L_DEVIS   DLIB1L ,
    MT_HT_L_DEVIS        DID9FACULT ,
    MT_TTC_L_DEVIS       DID9FACULT ,
    REM_TX_L_DEVIS       DID9FACULT ,
    REM_HT_L_DEVIS       DID9FACULT ,
    QUI_CREE_L_DEVIS     DLIB50 ,
    QUAND_CREE_L_DEVIS   TIMESTAMP DEFAULT ''NOW'',
    QUI_MODIF_L_DEVIS    DLIB50 ,
    QUAND_MODIF_L_DEVIS  TIMESTAMP DEFAULT ''NOW'',
    "VERSION"            NUM_VERSION ,
    IP_ACCES             DLIB50NN DEFAULT 0
)';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE43 
^
drop procedure GESTION_CREATION_TABLE43
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_GENERATOR0
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$GENERATOR_NAME
FROM RDB$GENERATORS a
where a.RDB$GENERATOR_NAME='NUM_ID_VISUALISATION')) THEN
  begin
    query = 'CREATE GENERATOR NUM_ID_VISUALISATION';
    EXECUTE STATEMENT :query;
    query = 'SET GENERATOR NUM_ID_VISUALISATION TO 10';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_GENERATOR0 
^
drop procedure GESTION_CREATION_GENERATOR0
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_GENERATOR1
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$GENERATOR_NAME
FROM RDB$GENERATORS a
where a.RDB$GENERATOR_NAME='NUM_ID_INFOS_DEVIS')) THEN
  begin
    query = 'CREATE GENERATOR NUM_ID_INFOS_DEVIS';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_GENERATOR1 
^
drop procedure GESTION_CREATION_GENERATOR1
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE44
as    
DECLARE VARIABLE QUERY VARCHAR(5000);
BEGIN
query = '';
IF (not exists( SELECT  a.RDB$RELATION_NAME
FROM RDB$RELATIONS a
where a.RDB$RELATION_NAME='TA_INFOS_DEVIS')) THEN
  begin
    query = 'CREATE TABLE TA_INFOS_DEVIS (
    ID_INFOS_DEVIS           DID3 NOT NULL ,
    ID_DEVIS                 DID3 ,
    ADRESSE1                   DLIB100 ,
    ADRESSE2                   DLIB100 ,
    ADRESSE3                   DLIB100 ,
    CODEPOSTAL                 DCODPOS ,
    VILLE                      DLIB100 ,
    PAYS                       DLIB100 ,
    ADRESSE1_LIV               DLIB100 ,
    ADRESSE2_LIV               DLIB100 ,
    ADRESSE3_LIV               DLIB100 ,
    CODEPOSTAL_LIV             DCODPOS ,
    VILLE_LIV                  DLIB100 ,
    PAYS_LIV                   DLIB100 ,
    CODE_COMPTA                DLIB8NN ,
    COMPTE                     DLIB8NN ,
    NOM_TIERS                  DLIB100 ,
    PRENOM_TIERS               DLIB100 ,
    SURNOM_TIERS               DLIB20 ,
    CODE_T_CIVILITE            DLGR_CODEL ,
    CODE_T_ENTITE              DLGR_CODEL ,
    TVA_I_COM_COMPL            DLIB50 ,
    CODE_C_PAIEMENT            DLGR_CODEL ,
    LIB_C_PAIEMENT             DLIB255 ,
    REPORT_C_PAIEMENT          DID_FACULTATIF ,
    FIN_MOIS_C_PAIEMENT        DID_FACULTATIF ,
    QUI_CREE_INFOS_DEVIS     DLIB50 ,
    QUAND_CREE_INFOS_DEVIS   TIMESTAMP DEFAULT ''NOW'',
    QUI_MODIF_INFOS_DEVIS    DLIB50 ,
    QUAND_MODIF_INFOS_DEVIS  TIMESTAMP DEFAULT ''NOW'',
    "VERSION"                  NUM_VERSION ,
    IP_ACCES                   DLIB50NN DEFAULT 0
)';

    EXECUTE STATEMENT :query;

    query = 'ALTER TABLE TA_INFOS_DEVIS ADD PRIMARY KEY (ID_INFOS_DEVIS)';
    EXECUTE STATEMENT :query;

    query = 'CREATE INDEX TA_INFOS_DEVIS_ID_DEVIS ON TA_INFOS_DEVIS (ID_DEVIS)';
    EXECUTE STATEMENT :query;

  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE44 
^
drop procedure GESTION_CREATION_TABLE44
^


CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER25
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBUID_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBUID_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER25
^
drop procedure GESTION_DROP_TRIGGER25
^

CREATE or ALTER  PROCEDURE GESTION_DROP_TRIGGER26
as    
DECLARE VARIABLE QUERY VARCHAR(500);
BEGIN
query ='';
IF (exists( SELECT a.RDB$TRIGGER_NAME
FROM RDB$TRIGGERS a
where a.RDB$TRIGGER_NAME ='TBIID_BONLIV_R_DOCUMENT')) THEN
  begin
    query = 'DROP TRIGGER TBIID_BONLIV_R_DOCUMENT';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_DROP_TRIGGER26
^
drop procedure GESTION_DROP_TRIGGER26
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_GENERATOR2
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$GENERATOR_NAME
FROM RDB$GENERATORS a
where a.RDB$GENERATOR_NAME='NUM_ID_INFOS_BONLIV')) THEN
  begin
    query = 'CREATE GENERATOR NUM_ID_INFOS_BONLIV';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_GENERATOR2 
^
drop procedure GESTION_CREATION_GENERATOR2
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE45
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='CODE_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD CODE_BONLIV DLGR_CODE,alter CODE_BONLIV position 2';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE45 
^
drop procedure GESTION_CREATION_TABLE45
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE46
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='DATE_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD DATE_BONLIV TIMESTAMP DEFAULT ''NOW'',alter DATE_BONLIV position 3';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE46 
^
drop procedure GESTION_CREATION_TABLE46
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE47
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='DATE_LIV_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD DATE_LIV_BONLIV TIMESTAMP DEFAULT ''NOW'',alter DATE_LIV_BONLIV position 5';
    EXECUTE STATEMENT :query;
  end
END
^

EXECUTE PROCEDURE GESTION_CREATION_TABLE47 
^
drop procedure GESTION_CREATION_TABLE47
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE48
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='LIBELLE_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD LIBELLE_BONLIV DLIB255NN,alter LIBELLE_BONLIV position 6';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE48 
^
drop procedure GESTION_CREATION_TABLE48
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE49
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='ID_ADRESSE')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD ID_ADRESSE DID_FACULTATIF,alter ID_ADRESSE position 7';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE49 
^
drop procedure GESTION_CREATION_TABLE49
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE50
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='ID_ADRESSE_LIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD ID_ADRESSE_LIV DID_FACULTATIF,alter ID_ADRESSE_LIV position 8';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE50 
^
drop procedure GESTION_CREATION_TABLE50
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE51
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='ID_TIERS')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD ID_TIERS DID3,alter ID_TIERS position 9';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE51 
^
drop procedure GESTION_CREATION_TABLE51
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE52
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='ID_T_PAIEMENT')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD ID_T_PAIEMENT DID_FACULTATIF,alter ID_T_PAIEMENT position 10';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE52 
^
drop procedure GESTION_CREATION_TABLE52
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE53
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='ID_C_PAIEMENT')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD ID_C_PAIEMENT DID_FACULTATIF,alter ID_C_PAIEMENT position 11';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE53 
^
drop procedure GESTION_CREATION_TABLE53
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE54
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='REM_HT_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD REM_HT_BONLIV DID9 DEFAULT 0,alter REM_HT_BONLIV position 12';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE54 
^
drop procedure GESTION_CREATION_TABLE54
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE55
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='TX_REM_HT_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD TX_REM_HT_BONLIV DID9 DEFAULT 0,alter TX_REM_HT_BONLIV position 13';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE55 
^
drop procedure GESTION_CREATION_TABLE55
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE56
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='REM_TTC_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD REM_TTC_BONLIV DID9 DEFAULT 0,alter REM_TTC_BONLIV position 14';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE56 
^
drop procedure GESTION_CREATION_TABLE56
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE57
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='TX_REM_TTC_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD TX_REM_TTC_BONLIV DID9 DEFAULT 0,alter TX_REM_TTC_BONLIV position 15';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE57 
^
drop procedure GESTION_CREATION_TABLE57
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE58
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='NB_E_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD NB_E_BONLIV DID4,alter NB_E_BONLIV position 16';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE58 
^
drop procedure GESTION_CREATION_TABLE58
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE59
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='TTC')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD TTC DBOOL,alter TTC position 17';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE59 
^
drop procedure GESTION_CREATION_TABLE59
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE60
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_BONLIV' and  a.RDB$FIELD_NAME ='COMMENTAIRE')) THEN
  begin
    query = 'ALTER TABLE TA_BONLIV ADD COMMENTAIRE DLIB_COMMENTAIRE,alter COMMENTAIRE position 18';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE60 
^
drop procedure GESTION_CREATION_TABLE60
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE61
as    
DECLARE VARIABLE QUERY VARCHAR(10000);
BEGIN
query = '';
IF (not exists( SELECT  a.RDB$RELATION_NAME
FROM RDB$RELATIONS a
where a.RDB$RELATION_NAME='TA_VISUALISATION')) THEN
  begin
    query = 'CREATE TABLE TA_VISUALISATION (
    ID             DID3 NOT NULL,
    CODE_REQUETE   DLIB255NN,
    REQUETE        DLIB_COMMENTAIRE,
    CHAMPS         DLIB_COMMENTAIRE,
    TITRE_CHAMPS   DLIB_COMMENTAIRE,
    TAILLE_CHAMPS  DLIB255,
    MODULE         DLIB255,
    IMPRESSION     DLIB255,
    IDENTIFIANT    DLIB255NN,
    ID_EDITEUR     DLIB255NN,
    ID_PLUGIN      DLIB255NN,
    GROUPBY        DLIB_COMMENTAIRE
)';

    EXECUTE STATEMENT :query;

    query = 'ALTER TABLE TA_VISUALISATION ADD PRIMARY KEY (ID)';
    EXECUTE STATEMENT :query;

    query = 'CREATE INDEX TA_VISUALISATION_ID ON TA_VISUALISATION (ID)';
    EXECUTE STATEMENT :query;

  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE61 
^
drop procedure GESTION_CREATION_TABLE61
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE62
as    
DECLARE VARIABLE QUERY VARCHAR(10000);
BEGIN
query = '';
IF (not exists( SELECT  a.RDB$RELATION_NAME
FROM RDB$RELATIONS a
where a.RDB$RELATION_NAME='TA_INFOS_BONLIV')) THEN
  begin
    query = 'CREATE TABLE TA_INFOS_BONLIV (
    ID_INFOS_BONLIV           DID3 NOT NULL ,
    ID_BONLIV                 DID3 ,
    ADRESSE1                 DLIB100 ,
    ADRESSE2                 DLIB100 ,
    ADRESSE3                 DLIB100 ,
    CODEPOSTAL               DCODPOS ,
    VILLE                    DLIB100 ,
    PAYS                     DLIB100 ,
    ADRESSE1_LIV             DLIB100 ,
    ADRESSE2_LIV             DLIB100 ,
    ADRESSE3_LIV             DLIB100 ,
    CODEPOSTAL_LIV           DCODPOS ,
    VILLE_LIV                DLIB100 ,
    PAYS_LIV                 DLIB100 ,
    CODE_COMPTA              DLIB8NN ,
    COMPTE                   DLIB8NN ,
    NOM_TIERS                DLIB100 ,
    PRENOM_TIERS             DLIB100 ,
    SURNOM_TIERS             DLIB20 ,
    CODE_T_CIVILITE          DLGR_CODEL ,
    CODE_T_ENTITE            DLGR_CODEL ,
    TVA_I_COM_COMPL          DLIB50 ,
    CODE_C_PAIEMENT          DLGR_CODEL ,
    LIB_C_PAIEMENT           DLIB255 ,
    REPORT_C_PAIEMENT        DID_FACULTATIF ,
    FIN_MOIS_C_PAIEMENT      DID_FACULTATIF ,
    QUI_CREE_INFOS_BONLIV     DLIB50 ,
    QUAND_CREE_INFOS_BONLIV   TIMESTAMP DEFAULT ''NOW'',
    QUI_MODIF_INFOS_BONLIV    DLIB50  ,
    QUAND_MODIF_INFOS_BONLIV  TIMESTAMP DEFAULT ''NOW'',
    "VERSION"                NUM_VERSION ,
    IP_ACCES                 DLIB50NN DEFAULT 0
)';

    EXECUTE STATEMENT :query;

    query = 'ALTER TABLE TA_INFOS_BONLIV ADD PRIMARY KEY (ID_INFOS_BONLIV)';
    EXECUTE STATEMENT :query;

    query = 'CREATE INDEX TA_INFOS_BONLIV_ID_BONLIV ON TA_INFOS_BONLIV (ID_BONLIV)';
    EXECUTE STATEMENT :query;

  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE62 
^
drop procedure GESTION_CREATION_TABLE62
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE63
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='ID_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD ID_BONLIV DID3,alter ID_BONLIV position 1';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE63 
^
drop procedure GESTION_CREATION_TABLE63
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE64
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='ID_T_LIGNE')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD ID_T_LIGNE DID3,alter ID_T_LIGNE position 2';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE64 
^
drop procedure GESTION_CREATION_TABLE64
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE65
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='ID_ARTICLE')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD ID_ARTICLE DID4,alter ID_ARTICLE position 3';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE65 
^
drop procedure GESTION_CREATION_TABLE65
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE66
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='NUM_LIGNE_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD NUM_LIGNE_L_BONLIV DID3,alter NUM_LIGNE_L_BONLIV position 4';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE66 
^
drop procedure GESTION_CREATION_TABLE66
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE67
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='LIB_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD LIB_L_BONLIV DLIB255,alter LIB_L_BONLIV position 5';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE67 
^
drop procedure GESTION_CREATION_TABLE67
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE68
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='QTE_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD QTE_L_BONLIV DID9FACULT,alter QTE_L_BONLIV position 6';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE68 
^
drop procedure GESTION_CREATION_TABLE68
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE69
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='U1_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD U1_L_BONLIV DLIB20,alter U1_L_BONLIV position 7';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE69 
^
drop procedure GESTION_CREATION_TABLE69
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE70
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='U2_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD U2_L_BONLIV DLIB20,alter U2_L_BONLIV position 8';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE70 
^
drop procedure GESTION_CREATION_TABLE70
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE71
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='PRIX_U_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD PRIX_U_L_BONLIV DID9FACULT,alter PRIX_U_L_BONLIV position 9';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE71 
^
drop procedure GESTION_CREATION_TABLE71
^



CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE72
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='TAUX_TVA_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD TAUX_TVA_L_BONLIV DLONG,alter TAUX_TVA_L_BONLIV position 10';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE72 
^
drop procedure GESTION_CREATION_TABLE72
^




CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE73
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='COMPTE_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD COMPTE_L_BONLIV DLIB8,alter COMPTE_L_BONLIV position 11';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE73 
^
drop procedure GESTION_CREATION_TABLE73
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE74
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='CODE_TVA_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD CODE_TVA_L_BONLIV DLIB20,alter CODE_TVA_L_BONLIV position 12';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE74 
^
drop procedure GESTION_CREATION_TABLE74
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE75
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='CODE_T_TVA_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD CODE_T_TVA_L_BONLIV DLIB1L,alter CODE_T_TVA_L_BONLIV position 13';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE75 
^
drop procedure GESTION_CREATION_TABLE75
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE76
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='MT_HT_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD MT_HT_L_BONLIV DID9FACULT,alter MT_HT_L_BONLIV position 14';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE76 
^
drop procedure GESTION_CREATION_TABLE76
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE77
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='MT_TTC_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD MT_TTC_L_BONLIV DID9FACULT,alter MT_TTC_L_BONLIV position 15';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE77 
^
drop procedure GESTION_CREATION_TABLE77
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE78
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='REM_TX_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD REM_TX_L_BONLIV DID9FACULT,alter REM_TX_L_BONLIV position 16';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE78 
^
drop procedure GESTION_CREATION_TABLE78
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE79
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query = '';
IF (not exists( SELECT a.RDB$FIELD_NAME, a.RDB$RELATION_NAME FROM RDB$RELATION_FIELDS a
where a.RDB$RELATION_NAME = 'TA_L_BONLIV' and  a.RDB$FIELD_NAME ='REM_HT_L_BONLIV')) THEN
  begin
    query = 'ALTER TABLE TA_L_BONLIV ADD REM_HT_L_BONLIV DID9FACULT,alter REM_HT_L_BONLIV position 17';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE79 
^
drop procedure GESTION_CREATION_TABLE79
^


CREATE or ALTER  PROCEDURE GESTION_CREATION_TABLE80
as    
DECLARE VARIABLE QUERY VARCHAR(5000);
BEGIN
query = '';
IF (not exists( SELECT  a.RDB$RELATION_NAME
FROM RDB$RELATIONS a
where a.RDB$RELATION_NAME='TA_L_BONLIV_TEMP')) THEN
  begin
    query = 'CREATE TABLE TA_L_BONLIV_TEMP (
    ID_L_BONLIV           DID3 ,
    ID_BONLIV             DID3 ,
    ID_T_LIGNE           DID3 ,
    ID_ARTICLE           DID4 ,
    NUM_LIGNE_L_BONLIV    DID3 ,
    LIB_L_BONLIV          DLIB255 ,
    QTE_L_BONLIV          DID9FACULT ,
    U1_L_BONLIV           DLIB20 ,
    U2_L_BONLIV           DLIB20 ,
    PRIX_U_L_BONLIV       DID9FACULT ,
    TAUX_TVA_L_BONLIV     DLONG ,
    COMPTE_L_BONLIV       DLIB8 ,
    CODE_TVA_L_BONLIV     DLIB20 ,
    CODE_T_TVA_L_BONLIV   DLIB1L ,
    MT_HT_L_BONLIV        DID9FACULT ,
    MT_TTC_L_BONLIV       DID9FACULT ,
    REM_TX_L_BONLIV       DID9FACULT ,
    REM_HT_L_BONLIV       DID9FACULT ,
    QUI_CREE_L_BONLIV     DLIB50 ,
    QUAND_CREE_L_BONLIV   TIMESTAMP DEFAULT ''NOW'',
    QUI_MODIF_L_BONLIV    DLIB50 ,
    QUAND_MODIF_L_BONLIV  TIMESTAMP DEFAULT ''NOW'',
    "VERSION"            NUM_VERSION ,
    IP_ACCES             DLIB50NN DEFAULT 0
)';
    EXECUTE STATEMENT :query;
  end
END
^
EXECUTE PROCEDURE GESTION_CREATION_TABLE80 
^
drop procedure GESTION_CREATION_TABLE80
^

RECREATE VIEW V2_FACTURE(
    ID_FACTURE,
    CODE_FACTURE,
    DATE_FACTURE,
    DATE_ECH_FACTURE,
    DATE_LIV_FACTURE,
    LIBELLE_FACTURE,
    CODE_TIERS,
    NOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    REGLE_FACTURE,
    TTC,
    NB_E_FACTURE,
    EXPORT,
    COMMENTAIRE)
AS
select
Facture.ID_FACTURE,
Facture.CODE_FACTURE,
Facture.DATE_FACTURE,
Facture.DATE_ECH_FACTURE,
Facture.DATE_LIV_FACTURE,
Facture.LIBELLE_FACTURE,
Tiers.code_tiers,
infos.NOM_TIERS,
infos.CODE_COMPTA,
infos.COMPTE,
Facture.REGLE_FACTURE,
Facture.ttc,
Facture.nb_e_facture,
Facture.export,
Facture.COMMENTAIRE


from TA_FACTURE Facture
left join ta_tiers Tiers on (Tiers.id_tiers = Facture.id_tiers)
left join ta_infos_facture infos on (infos.id_facture = facture.id_facture)
^

RECREATE VIEW V_BONLIV(
    ID_BONLIV,
    CODE_BONLIV,
    DATE_BONLIV,
    DATE_LIV_BONLIV,
    LIBELLE_BONLIV,
    ID_ADRESSE,
    ADRESSE1_ADRESSE,
    ADRESSE2_ADRESSE,
    ADRESSE3_ADRESSE,
    CODEPOSTAL_ADRESSE,
    VILLE_ADRESSE,
    PAYS_ADRESSE,
    ID_ADRESSE_LIV,
    ADRESSE1_ADRESSELIV,
    ADRESSE2_ADRESSELIV,
    ADRESSE3_ADRESSELIV,
    CODEPOSTAL_ADRESSELIV,
    VILLE_ADRESSELIV,
    PAYS_LIV,
    ID_TIERS,
    CODE_TIERS,
    NOM_TIERS,
    PRENOM_TIERS,
    SURNOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    ID_T_PAIEMENT,
    CODE_T_PAIEMENT,
    ID_C_PAIEMENT,
    REM_HT_BONLIV,
    TX_REM_HT_BONLIV,
    REM_TTC_BONLIV,
    TX_REM_TTC_BONLIV,
    NB_E_BONLIV,
    MT_TTC_CALC,
    MT_HT_CALC,
    MT_TVA_CALC,
    NET_TTC_CALC,
    NET_HT_CALC,
    NET_TVA_CALC,
    IP_ACCES,
    TTC)
AS
select
  BONLIV.ID_BONLIV,
  BONLIV.CODE_BONLIV,
  BONLIV.DATE_BONLIV,
  BONLIV.date_liv_BONLIV,
  BONLIV.LIBELLE_BONLIV,
  BONLIV.ID_ADRESSE,
  infos.adresse1,
  infos.adresse2,
  infos.adresse3,
  infos.codepostal,
  infos.ville,
  infos.pays,
  BONLIV.ID_ADRESSE_LIV,
  infos.adresse1_liv,
  infos.adresse2_liv,
  infos.adresse3_liv,
  infos.codepostal_liv,
  infos.ville_liv,
  infos.PAYS_LIV,
  BONLIV.ID_TIERS,
  Tiers.code_tiers,
  infos.NOM_TIERS,
  infos.PRENOM_TIERS,
  infos.SURNOM_TIERS,
  infos.CODE_COMPTA,
  infos.COMPTE,
  BONLIV.ID_T_PAIEMENT,
  TPaiement.code_t_paiement,
  CPaiement.id_c_paiement,
  BONLIV.REM_HT_BONLIV,
  BONLIV.TX_REM_HT_BONLIV,
  BONLIV.REM_TTC_BONLIV,
  BONLIV.TX_REM_TTC_BONLIV,
  BONLIV.nb_e_BONLIV,
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  BONLIV.IP_ACCES,
  BONLIV.TTC


    
  from TA_BONLIV BONLIV
  left join ta_infos_BONLIV infos on (infos.ID_INFOS_BONLIV = BONLIV.id_adresse )
  left join ta_tiers Tiers on (Tiers.id_tiers = BONLIV.id_tiers)
  left join ta_t_paiement TPaiement on (TPaiement.id_t_paiement = BONLIV.id_t_paiement)
  left join ta_c_paiement CPaiement on (CPaiement.id_c_paiement = BONLIV.id_c_paiement)
^


RECREATE VIEW V_INFOS_BONLIV(
    ID_INFOS_BONLIV,
    ID_BONLIV,
    ADRESSE1,
    ADRESSE2,
    ADRESSE3,
    CODEPOSTAL,
    VILLE,
    PAYS,
    ADRESSE1_LIV,
    ADRESSE2_LIV,
    ADRESSE3_LIV,
    CODEPOSTAL_LIV,
    VILLE_LIV,
    PAYS_LIV,
    CODE_COMPTA,
    COMPTE,
    ID_TIERS,
    NOM_TIERS,
    PRENOM_TIERS,
    SURNOM_TIERS,
    CODE_T_CIVILITE,
    CODE_T_ENTITE,
    TVA_I_COM_COMPL)
AS
select
  
  infos.ID_INFOS_BONLIV,
  infos.ID_BONLIV,
  infos.ADRESSE1,
  infos.ADRESSE2,
  infos.ADRESSE3,
  infos.CODEPOSTAL,
  infos.VILLE,
  infos.PAYS,        
  infos.ADRESSE1_LIV,
  infos.ADRESSE2_LIV,
  infos.ADRESSE3_LIV,
  infos.CODEPOSTAL_LIV,
  infos.VILLE_LIV,
  infos.PAYS_LIV,
  infos.CODE_COMPTA,
  infos.COMPTE,
  cast (null as INTEGER),
  infos.NOM_TIERS,
  infos.PRENOM_TIERS,
  infos.SURNOM_TIERS,
  infos.CODE_T_CIVILITE,
  infos.CODE_T_ENTITE,
  infos.TVA_I_COM_COMPL
  
   
  from TA_INFOS_BONLIV infos 
  
  union   

  select
  
  cast (null as INTEGER),
  cast (null as INTEGER),
  adresse.ADRESSE1_ADRESSE,
  adresse.ADRESSE2_ADRESSE,
  adresse.ADRESSE3_ADRESSE,
  adresse.CODEPOSTAL_ADRESSE,
  adresse.VILLE_ADRESSE,
  adresse.PAYS_ADRESSE,         
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(5)),
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(8)),
  cast(null as varchar(8)),
  tiers.id_tiers,
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(20)),
  civilite.CODE_T_CIVILITE,
  cast (null as varchar(20)),
  cast (null as varchar(50))
  
  from ta_adresse adresse 
  left join ta_r_adr rAdr on rAdr.ID_ADRESSE = adresse.ID_ADRESSE  
  left join Ta_tiers tiers on tiers.ID_TIERS = rAdr.ID_TIERS
  left join TA_T_CIVILITE civilite on civilite.id_T_civilite = tiers.id_T_civilite
^

RECREATE VIEW V2_BONLIV(
    ID_BONLIV,
    CODE_BONLIV,
    DATE_BONLIV,
    DATE_LIV_BONLIV,
    LIBELLE_BONLIV,
    CODE_TIERS,
    NOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    TTC,
    NB_E_BONLIV,
    COMMENTAIRE)
AS
select
bonLiv.ID_BONLIV,
bonLiv.CODE_BONLIV,
bonLiv.DATE_BONLIV,
bonLiv.DATE_LIV_BONLIV,
bonLiv.LIBELLE_BONLIV,
Tiers.code_tiers,
infos.NOM_TIERS,
infos.CODE_COMPTA,
infos.COMPTE,
bonLiv.ttc,
bonLiv.nb_e_BONLIV,
bonliv.commentaire
from TA_BONLIV bonLiv
left join ta_tiers Tiers on (Tiers.id_tiers = bonLiv.id_tiers)
left join ta_infos_BONLIV infos on (infos.id_BONLIV = bonLiv.id_BONLIV)
^


-- CREATE OR ALTER PROCEDURES -------------------------
-------------------------------------------------------

CREATE OR ALTER PROCEDURE ENREGISTRE_LIGNES_BONLIV (
    NEW_ID_BONLIV INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE V_ID_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_LIB_L_DOCUMENT VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_DOCUMENT NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_DOCUMENT VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_DOCUMENT VARCHAR(8);
begin
exit;
end
^


CREATE or ALTER  PROCEDURE MAJ_LIGNES_BONLIV (
    ID_DOCUMENT_RECUP INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE ID_L_DOCUMENT_COURANT INTEGER;
DECLARE VARIABLE V_ID_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_LIB_L_DOCUMENT VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_DOCUMENT NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_DOCUMENT VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_DOCUMENT VARCHAR(8);
begin
EXIT;
end
^


CREATE OR ALTER TRIGGER TBI_TA_INFOS_BONLIV FOR TA_INFOS_BONLIV
ACTIVE BEFORE INSERT POSITION 0
as
begin
   If (New.ID_INFOS_BONLIV is null) Then
      New.ID_INFOS_BONLIV = GEN_ID(NUM_ID_INFOS_BONLIV,1);
   New.QUI_CREE_INFOS_BONLIV = USER;
   new.QUAND_CREE_INFOS_BONLIV = 'NOW';
   new.QUI_MODIF_INFOS_BONLIV = USER;
   new.QUAND_MODIF_INFOS_BONLIV = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBU_TA_INFOS_BONLIV FOR TA_INFOS_BONLIV
ACTIVE BEFORE UPDATE POSITION 0
as
begin
   new.QUI_MODIF_INFOS_BONLIV = USER;
   new.QUAND_MODIF_INFOS_BONLIV = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^

CREATE OR ALTER TRIGGER TBIID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_BONLIV is not null) then
       begin
       select count(*) from TA_BONLIV
       where ID_BONLIV= NEW.ID_BONLIV
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_BONLIV;
       end   
end
^

CREATE OR ALTER TRIGGER TBUID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_BONLIV <> NEW.ID_BONLIV)) then
   begin
     select count(*) from TA_BONLIV
     where ID_BONLIV = NEW.ID_BONLIV
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_BONLIV;
   end
end
^

CREATE OR ALTER TRIGGER TA_BONLIV_AI0 FOR TA_BONLIV
ACTIVE AFTER INSERT POSITION 0
AS
begin
execute procedure enregistre_lignes_BONLIV(new.id_BONLIV,new.ttc);
end
^
CREATE OR ALTER TRIGGER TA_BONLIV_AIU0 FOR TA_BONLIV
ACTIVE AFTER INSERT OR UPDATE POSITION 0
AS
begin
  execute procedure annule_modification('ta_BONLIV','code_BONLIV',new.code_BONLIV);
end
^
CREATE OR ALTER TRIGGER TA_BONLIV_AU0 FOR TA_BONLIV
INACTIVE AFTER UPDATE POSITION 0
AS
begin
execute procedure maj_lignes_BONLIV(old.id_BONLIV,new.ttc);
end
^
CREATE OR ALTER TRIGGER TBDID_BONLIV_ETRANGER FOR TA_BONLIV
ACTIVE AFTER DELETE POSITION 1
as
begin
  delete from ta_l_BONLIV where id_BONLIV = old.id_BONLIV;
  delete from TA_COM_DOC where ID_DOCUMENT = old.ID_BONLIV;
  delete from ta_l_BONLIV_temp where id_BONLIV = old.id_BONLIV;
  delete from ta_infos_BONLIV where id_BONLIV = old.id_BONLIV;
end
^
CREATE OR ALTER TRIGGER TBIID_ADRESSE_BONLIV FOR TA_BONLIV
INACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE */
   if (NEW.ID_ADRESSE is not null) then
       begin
       select count(*) from TA_ADRESSE
       where ID_ADRESSE = NEW.ID_ADRESSE
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_ADRESSE;
       end   
end
^
CREATE OR ALTER TRIGGER TBIID_ADRESSE_LIV_BONLIV FOR TA_BONLIV
INACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE_L */
   if (NEW.ID_ADRESSE_LIV is not null) then
       begin
       select count(*) from TA_ADRESSE
       where ID_ADRESSE= NEW.ID_ADRESSE_LIV
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_ADRESSE_L;
       end   
end
^
CREATE OR ALTER TRIGGER TBIID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
   if (NEW.ID_BONLIV is not null) then
       begin
       select count(*) from TA_BONLIV
       where ID_BONLIV= NEW.ID_BONLIV
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_BONLIV;
       end   
end
^
CREATE OR ALTER TRIGGER TBIID_TIERS_BONLIV FOR TA_BONLIV
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_TIERS */
   if (NEW.ID_TIERS is not null) then
       begin
       select count(*) from TA_TIERS
       where ID_TIERS= NEW.ID_TIERS
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_TIERS;
       end   
end
^
CREATE OR ALTER TRIGGER TBIID_T_PAIEMENT_BONLIV FOR TA_BONLIV
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_PAIEMENT */
   if (NEW.ID_T_PAIEMENT is not null) then
       begin
       select count(*) from TA_T_PAIEMENT
       where ID_T_PAIEMENT= NEW.ID_T_PAIEMENT
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_T_PAIEMENT;
       end   
end
^
CREATE OR ALTER TRIGGER TBI_BONLIV FOR TA_BONLIV
ACTIVE BEFORE INSERT POSITION 2
as
begin
   If (New.ID_BONLIV  is null) Then
      New.ID_BONLIV  = GEN_ID(num_id_BONLIV,1);
   New.CODE_BONLIV = Upper(New.CODE_BONLIV);
   New.QUI_CREE_BONLIV  = USER;
   New.QUAND_CREE_BONLIV = 'NOW';
   New.QUI_MODIF_BONLIV = USER;
   New.QUAND_MODIF_BONLIV = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^

CREATE or ALTER  PROCEDURE GESTION_CREATION_1
as    
DECLARE VARIABLE QUERY VARCHAR(255);
BEGIN
query ='';
IF (not exists( SELECT a.RDB$EXCEPTION_NAME
FROM RDB$EXCEPTIONS a
where a.RDB$EXCEPTION_NAME ='E_XAKCODE_BONLIV')) THEN
  begin
    query = 'CREATE EXCEPTION E_XAKCODE_BONLIV ''Le bon de livraison doit être unique''';
    EXECUTE STATEMENT :query;
  end
END
^



EXECUTE PROCEDURE GESTION_CREATION_1 
^
drop procedure GESTION_CREATION_1
^


CREATE OR ALTER TRIGGER TBI_XAKCODE_BONLIV FOR TA_BONLIV
ACTIVE BEFORE INSERT POSITION 0
as
DECLARE variable numrows integer;
begin
  /* XAKCODE_BONLIV */
   select count(*) from TA_BONLIV
   where CODE_BONLIV = NEW.CODE_BONLIV
   into :numrows;
   if (numrows > 0) then
      exception E_XAKCODE_BONLIV;
end
^

CREATE OR ALTER TRIGGER TBUID_ADRESSE_BONLIV FOR TA_BONLIV
INACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* XAKID_ADRESSE */
   if ((OLD.ID_ADRESSE <> NEW.ID_ADRESSE)) then
   begin
     select count(*) from TA_ADRESSE
     where ID_ADRESSE = NEW.ID_ADRESSE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ADRESSE;
   end
end
^

CREATE OR ALTER TRIGGER TBUID_ADRESSE_LIV_BONLIV FOR TA_BONLIV
INACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE_L */
   if ((OLD.ID_ADRESSE_LIV <> NEW.ID_ADRESSE_LIV)) then
   begin
     select count(*) from TA_ADRESSE
     where ID_ADRESSE = NEW.ID_ADRESSE_LIV
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ADRESSE_L;
   end
end
^

CREATE OR ALTER TRIGGER TBUID_BONLIV_ETRANGER FOR TA_BONLIV
ACTIVE AFTER DELETE POSITION 1
as
begin
delete from TA_R_DOCUMENT where old.id_BONLIV = id_BONLIV;
end
^


CREATE OR ALTER TRIGGER TBUID_BONLIV_R_DOCUMENT FOR TA_R_DOCUMENT
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
   if ((OLD.ID_BONLIV <> NEW.ID_BONLIV)) then
   begin
     select count(*) from TA_BONLIV
     where ID_BONLIV = NEW.ID_BONLIV
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_BONLIV;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_TIERS_BONLIV FOR TA_BONLIV
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_TIERS */
   if ((OLD.ID_TIERS <> NEW.ID_TIERS)) then
   begin
     select count(*) from TA_TIERS
     where ID_TIERS = NEW.ID_TIERS
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_TIERS;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_T_PAIEMENT_BONLIV FOR TA_BONLIV
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_PAIEMENT */
   if ((OLD.ID_T_PAIEMENT <> NEW.ID_T_PAIEMENT)) then
   begin
     select count(*) from TA_T_PAIEMENT
     where ID_T_PAIEMENT = NEW.ID_T_PAIEMENT
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_T_PAIEMENT;
   end
end
^


CREATE OR ALTER TRIGGER TBU_BONLIV FOR TA_BONLIV
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   New.CODE_BONLIV = Upper(New.CODE_BONLIV);
   new.QUI_MODIF_BONLIV = USER;
   new.QUAND_MODIF_BONLIV = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBU_XAKCODE_BONLIV FOR TA_BONLIV
ACTIVE BEFORE UPDATE POSITION 0
as
DECLARE variable numrows integer;
begin
  /* XAKCODE_BONLIV */
   if ((OLD.CODE_BONLIV <> NEW.CODE_BONLIV)) then
   begin
   select count(*) from TA_BONLIV
   where CODE_BONLIV = NEW.CODE_BONLIV
   into :numrows;
   if (numrows > 0) then
      exception E_XAKCODE_BONLIV;
   end
end
^

/* Trigger: TA_L_BONLIV_TEMP_BU0 */
CREATE OR ALTER TRIGGER TA_L_BONLIV_TEMP_BU0 FOR TA_L_BONLIV_TEMP
ACTIVE BEFORE UPDATE POSITION 2
as
declare variable typeLigne integer;
begin
TYPELIGNE=0;
select typeL.id_t_ligne from  ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
if (new.id_t_ligne <> typeLigne) then
begin
new.qte_l_BONLIV=null;
new.prix_u_l_BONLIV=null;
new.taux_tva_l_BONLIV=null;
new.code_tva_l_BONLIV=null;
new.mt_ht_l_BONLIV=null;
new.mt_ttc_l_BONLIV=null;
new.rem_tx_l_BONLIV=null;
new.rem_ht_l_BONLIV=null;
end
   new.QUI_MODIF_L_BONLIV = USER;
   new.QUAND_MODIF_L_BONLIV = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^


/* Trigger: TBI_L_BONLIV_TEMP */
CREATE OR ALTER TRIGGER TBI_L_BONLIV_TEMP FOR TA_L_BONLIV_TEMP
ACTIVE BEFORE INSERT POSITION 2
as
declare variable typeLigne integer;
begin
TYPELIGNE=0;
select typeL.id_t_ligne from  ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
if (new.id_t_ligne <> typeLigne) then
begin
new.qte_l_BONLIV=null;
new.prix_u_l_BONLIV=null;
new.taux_tva_l_BONLIV=null;
new.code_tva_l_BONLIV=null;
new.mt_ht_l_BONLIV=null;
new.mt_ttc_l_BONLIV=null;
new.rem_tx_l_BONLIV=null;
new.rem_ht_l_BONLIV=null;
end
   If (New.ID_L_BONLIV  is null) Then
      New.ID_L_BONLIV  = GEN_ID(NUM_ID_L_BONLIV,1);
   New.QUI_CREE_L_BONLIV  = USER;
   New.QUAND_CREE_L_BONLIV = 'NOW';
   New.QUI_MODIF_L_BONLIV = USER;
   New.QUAND_MODIF_L_BONLIV = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^



RECREATE VIEW V_L_BONLIV(
    ID_L_BONLIV,
    ID_BONLIV,
    ID_T_LIGNE,
    ID_ARTICLE,
    NUM_LIGNE_L_BONLIV,
    CODE_ARTICLE,
    LIB_L_BONLIV,
    QTE_L_BONLIV,
    U1_L_BONLIV,
    U2_L_BONLIV,
    PRIX_U_L_BONLIV,
    TAUX_TVA_L_BONLIV,
    COMPTE_L_BONLIV,
    CODE_TVA_L_BONLIV,
    CODE_T_TVA_L_BONLIV,
    MT_HT_L_BONLIV,
    MT_TTC_L_BONLIV,
    REM_TX_L_BONLIV,
    REM_HT_L_BONLIV,
    IP_ACCES)
AS
select

  LBONLIV.ID_L_BONLIV,
  LBONLIV.ID_BONLIV,
  LBONLIV.ID_T_LIGNE,
  LBONLIV.ID_ARTICLE,
  LBONLIV.NUM_LIGNE_L_BONLIV,
  article.CODE_ARTICLE,
  LBONLIV.LIB_L_BONLIV,
  LBONLIV.QTE_L_BONLIV,
  LBONLIV.U1_L_BONLIV,
  LBONLIV.U2_L_BONLIV,
  LBONLIV.PRIX_U_L_BONLIV,
  LBONLIV.TAUX_TVA_L_BONLIV,
  LBONLIV.COMPTE_L_BONLIV,
  LBONLIV.CODE_TVA_L_BONLIV,
  LBONLIV.CODE_T_TVA_L_BONLIV,
  LBONLIV.MT_HT_L_BONLIV,
  LBONLIV.MT_TTC_L_BONLIV,
  LBONLIV.REM_TX_L_BONLIV,
  LBONLIV.REM_HT_L_BONLIV,
    LBONLIV.IP_ACCES
  
  from TA_L_BONLIV LBONLIV
  left join TA_ARTICLE article on (article.id_article = LBONLIV.id_article)
^


RECREATE VIEW V_L_BONLIV_TEMP(
    ID_L_BONLIV,
    ID_BONLIV,
    ID_T_LIGNE,
    ID_ARTICLE,
    NUM_LIGNE_L_BONLIV,
    CODE_ARTICLE,
    LIB_L_BONLIV,
    QTE_L_BONLIV,
    U1_L_BONLIV,
    U2_L_BONLIV,
    PRIX_U_L_BONLIV,
    TAUX_TVA_L_BONLIV,
    COMPTE_L_BONLIV,
    CODE_TVA_L_BONLIV,
    CODE_T_TVA_L_BONLIV,
    MT_HT_L_BONLIV,
    MT_TTC_L_BONLIV,
    REM_TX_L_BONLIV,
    REM_HT_L_BONLIV,
    IP_ACCES)
AS
select
  LBONLIV.ID_L_BONLIV,
  LBONLIV.ID_BONLIV,
  LBONLIV.ID_T_LIGNE,
  LBONLIV.ID_ARTICLE,
  LBONLIV.NUM_LIGNE_L_BONLIV,
  article.CODE_ARTICLE,
  LBONLIV.LIB_L_BONLIV,
  LBONLIV.QTE_L_BONLIV,
  LBONLIV.U1_L_BONLIV,
  LBONLIV.U2_L_BONLIV,
  LBONLIV.PRIX_U_L_BONLIV,
  LBONLIV.TAUX_TVA_L_BONLIV,
  LBONLIV.COMPTE_L_BONLIV,
  LBONLIV.CODE_TVA_L_BONLIV,
  LBONLIV.CODE_T_TVA_L_BONLIV,
  LBONLIV.MT_HT_L_BONLIV,
  LBONLIV.MT_TTC_L_BONLIV,
  LBONLIV.REM_TX_L_BONLIV,
  LBONLIV.REM_HT_L_BONLIV,
  LBONLIV.IP_ACCES
  from TA_L_BONLIV_TEMP LBONLIV 
  left join TA_ARTICLE article on (article.id_article = LBONLIV.id_article)
^



CREATE or ALTER PROCEDURE MAJ_GENERATEUR 
AS
DECLARE VARIABLE V_GEN INTEGER;
DECLARE VARIABLE V_MAX INTEGER;
begin
exit;
end
^

CREATE or ALTER  PROCEDURE INFOSBONLIV (
    ID_DOCUMENT_RECUP INTEGER,
    ID_TIERS_RECUP INTEGER,
    LIVRAISON INTEGER)
RETURNS (
    ID_INFOS_BONLIV INTEGER,
    ID_ADRESSE INTEGER,
    ID_BONLIV INTEGER,
    ADRESSE1 VARCHAR(100),
    ADRESSE2 VARCHAR(100),
    ADRESSE3 VARCHAR(100),
    CODEPOSTAL VARCHAR(5),
    VILLE VARCHAR(100),
    PAYS VARCHAR(100),
    ADRESSE1_LIV VARCHAR(100),
    ADRESSE2_LIV VARCHAR(100),
    ADRESSE3_LIV VARCHAR(100),
    CODEPOSTAL_LIV VARCHAR(5),
    VILLE_LIV VARCHAR(100),
    PAYS_LIV VARCHAR(100),
    CODE_COMPTA VARCHAR(7),
    COMPTE VARCHAR(8),
    ID_TIERS INTEGER,
    NOM_TIERS VARCHAR(100),
    PRENOM_TIERS VARCHAR(100),
    SURNOM_TIERS VARCHAR(20),
    CODE_T_CIVILITE VARCHAR(20),
    CODE_T_ENTITE VARCHAR(20),
    TVA_I_COM_COMPL VARCHAR(50),
    CODE_C_PAIEMENT VARCHAR(50),
    LIB_C_PAIEMENT VARCHAR(255),
    REPORT_C_PAIEMENT INTEGER,
    FIN_MOIS_C_PAIEMENT INTEGER)
AS
begin
exit;
end
^



CREATE OR ALTER PROCEDURE CALCUL_TVA_TA_L_FACTURE (
    MODULE VARCHAR(255),
    ID_DOCUMENT INTEGER,
    EXPORT INTEGER)
RETURNS (
    ID_DOCUMENT_RECUP SMALLINT,
    TAUX_RECUP NUMERIC(15,4),
    CODE_TVA_RECUP VARCHAR(20),
    MT_TVA_RECUP NUMERIC(15,2),
    LIBELLE_RECUP VARCHAR(100),
    MT_HT NUMERIC(15,2),
    MT_TTC NUMERIC(15,2),
    TAUXREMISE NUMERIC(15,2),
    MT_HT_REMISE NUMERIC(15,2),
    MT_TTC_REMISE NUMERIC(15,2))
AS
DECLARE VARIABLE QUERY1 VARCHAR(1000);
DECLARE VARIABLE QUERY2 VARCHAR(1000);
DECLARE VARIABLE ID INTEGER;
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE TTC SMALLINT;
begin 
exit;
end
^


CREATE OR ALTER PROCEDURE DISPATCHER_TVA_DOCUMENT (
    MODULE VARCHAR(255),
    ID_DOCUMENT INTEGER,
    TTC INTEGER,
    TAUXREMISE NUMERIC(15,2))
AS
DECLARE VARIABLE QUERY1 VARCHAR(1000);
DECLARE VARIABLE CODE_TVA VARCHAR(20);
DECLARE VARIABLE TAUX NUMERIC(15,4);
DECLARE VARIABLE TOTAL_TVA NUMERIC(15,2);
DECLARE VARIABLE TOTALHT NUMERIC(15,2);
DECLARE VARIABLE NBLIGNE INTEGER;
DECLARE VARIABLE HT_LIGNE NUMERIC(15,2);
DECLARE VARIABLE ID_LIGNE INTEGER;
DECLARE VARIABLE LIGNEPASSE INTEGER;
DECLARE VARIABLE TVA_LIGNE NUMERIC(15,2);
DECLARE VARIABLE TVATMP NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE TOTALTTC NUMERIC(15,2);
DECLARE VARIABLE TTC_LIGNE NUMERIC(15,2);
begin
exit;
end
^


CREATE OR ALTER PROCEDURE VIDE_DOCUMENT_TEMP (
    MODULE VARCHAR(255))
AS
begin
exit;
end
^


CREATE OR ALTER PROCEDURE CREE_DOCUMENT_SUR_DOCUMENT (
    CODEFIXE VARCHAR(9),
    MODULE_SOURCE VARCHAR(255),
    MODULE_DEST VARCHAR(255),
    QUERY_IN VARCHAR(1000))
RETURNS (
    CODE_DOCUMENT_TMP VARCHAR(9))
AS
BEGIN
  EXIT;
END
^




CREATE OR ALTER PROCEDURE ENREGISTRE_LIGNES_DEVIS (
    NEW_ID_DEVIS INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE V_ID_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_LIB_L_DOCUMENT VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_DOCUMENT NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_DOCUMENT VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_DOCUMENT VARCHAR(8);
begin
  EXIT;
end
^


CREATE OR ALTER PROCEDURE MAJ_LIGNES_DEVIS (
    ID_DOCUMENT_RECUP INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE ID_L_DOCUMENT_COURANT INTEGER;
DECLARE VARIABLE V_ID_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_LIB_L_DOCUMENT VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_DOCUMENT NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_DOCUMENT VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_DOCUMENT VARCHAR(8);
begin
  EXIT;
end
^







CREATE OR ALTER PROCEDURE RECUP_LIGNES_FACTURE (
    CODE_FACTURE_RECUP VARCHAR(50))
RETURNS (
    ID_FACTURE_RECUP INTEGER)
AS
DECLARE VARIABLE V_ID_L_FACTURE INTEGER;
DECLARE VARIABLE V_ID_FACTURE INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_FACTURE INTEGER;
DECLARE VARIABLE V_LIB_L_FACTURE VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_FACTURE NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_CODE_T_TVA_L_FACTURE VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_FACTURE VARCHAR(8);
begin
  EXIT;
end
^



CREATE OR ALTER PROCEDURE RECUP_LIGNES_EXPORTATION (
    ID_FACTURE_RECUP INTEGER,
    TTC INTEGER,
    TAUXREMISE NUMERIC(15,2))
RETURNS (
    ID_L_FACTURE INTEGER,
    ID_FACTURE INTEGER,
    ID_T_LIGNE INTEGER,
    ID_ARTICLE INTEGER,
    NUM_LIGNE_L_FACTURE INTEGER,
    LIB_L_FACTURE VARCHAR(255),
    QTE_L_FACTURE NUMERIC(15,2),
    U1_L_FACTURE VARCHAR(20),
    U2_L_FACTURE VARCHAR(20),
    PRIX_U_L_FACTURE NUMERIC(15,2),
    TAUX_TVA_L_FACTURE NUMERIC(15,4),
    CODE_TVA_L_FACTURE VARCHAR(20),
    CODE_T_TVA_L_FACTURE VARCHAR(1),
    MT_HT_L_FACTURE NUMERIC(15,2),
    MT_TTC_L_FACTURE NUMERIC(15,2),
    REM_TX_L_FACTURE NUMERIC(15,2),
    REM_HT_L_FACTURE NUMERIC(15,2),
    TVALIGNE NUMERIC(15,2),
    COMPTE_L_FACTURE VARCHAR(8))
AS
DECLARE VARIABLE CODE_TVA VARCHAR(20);
DECLARE VARIABLE TAUX NUMERIC(15,4);
DECLARE VARIABLE TOTAL_TVA NUMERIC(15,2);
DECLARE VARIABLE TOTALHT NUMERIC(15,2);
DECLARE VARIABLE NBLIGNE INTEGER;
DECLARE VARIABLE LIGNEPASSE INTEGER;
DECLARE VARIABLE TVA_LIGNE NUMERIC(15,2);
DECLARE VARIABLE TVATMP NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE TOTALTTC NUMERIC(15,2);
DECLARE VARIABLE TOTAL_TTC_REMISE NUMERIC(15,2);
DECLARE VARIABLE TOTAL_HT_REMISE NUMERIC(15,2);
begin
  EXIT;
end
^






CREATE OR ALTER PROCEDURE ENREGISTRE_LIGNES_FACTURE (
    NEW_ID_FACTURE INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE V_ID_L_FACTURE INTEGER;
DECLARE VARIABLE V_ID_FACTURE INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_FACTURE INTEGER;
DECLARE VARIABLE V_LIB_L_FACTURE VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_FACTURE NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_FACTURE VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_FACTURE VARCHAR(8);
begin
  EXIT;
end
^


CREATE OR ALTER PROCEDURE MAJ_LIGNES_FACTURE (
    ID_FACTURE_RECUP INTEGER,
    TTC INTEGER)
AS
DECLARE VARIABLE ID_L_FACTURE_COURANT INTEGER;
DECLARE VARIABLE V_ID_L_FACTURE INTEGER;
DECLARE VARIABLE V_ID_FACTURE INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_FACTURE INTEGER;
DECLARE VARIABLE V_LIB_L_FACTURE VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_FACTURE NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_FACTURE VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_FACTURE NUMERIC(15,2);
DECLARE VARIABLE TYPELIGNE INTEGER;
DECLARE VARIABLE V_CODE_T_TVA_L_FACTURE VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_FACTURE VARCHAR(8);
begin
  EXIT;
end
^



CREATE OR ALTER PROCEDURE RECUP_LIGNES_DEVIS (
    CODE_DOCUMENT_RECUP VARCHAR(50))
RETURNS (
    ID_DOCUMENT_RECUP INTEGER)
AS
DECLARE VARIABLE V_ID_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_DOCUMENT INTEGER;
DECLARE VARIABLE V_ID_T_LIGNE INTEGER;
DECLARE VARIABLE V_ID_ARTICLE INTEGER;
DECLARE VARIABLE V_NUM_LIGNE_L_DOCUMENT INTEGER;
DECLARE VARIABLE V_LIB_L_DOCUMENT VARCHAR(255) CHARACTER SET NONE;
DECLARE VARIABLE V_QTE_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_U1_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_U2_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_PRIX_U_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_TAUX_TVA_L_DOCUMENT NUMERIC(15,4);
DECLARE VARIABLE V_CODE_TVA_L_DOCUMENT VARCHAR(20) CHARACTER SET NONE;
DECLARE VARIABLE V_MT_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_MT_TTC_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_TX_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_REM_HT_L_DOCUMENT NUMERIC(15,2);
DECLARE VARIABLE V_CODE_T_TVA_L_DOCUMENT VARCHAR(1);
DECLARE VARIABLE V_COMPTE_L_DOCUMENT VARCHAR(8);
begin
  EXIT;
end
^






RECREATE VIEW V_INFOS_DEVIS(
    ID_INFOS_DEVIS,
    ID_DEVIS,
    ADRESSE1,
    ADRESSE2,
    ADRESSE3,
    CODEPOSTAL,
    VILLE,
    PAYS,
    ADRESSE1_LIV,
    ADRESSE2_LIV,
    ADRESSE3_LIV,
    CODEPOSTAL_LIV,
    VILLE_LIV,
    PAYS_LIV,
    CODE_COMPTA,
    COMPTE,
    ID_TIERS,
    NOM_TIERS,
    PRENOM_TIERS,
    SURNOM_TIERS,
    CODE_T_CIVILITE,
    CODE_T_ENTITE,
    TVA_I_COM_COMPL)
AS
select
  infos.ID_INFOS_DEVIS,
  infos.ID_DEVIS,
  infos.ADRESSE1,
  infos.ADRESSE2,
  infos.ADRESSE3,
  infos.CODEPOSTAL,
  infos.VILLE,
  infos.PAYS,        
  infos.ADRESSE1_LIV,
  infos.ADRESSE2_LIV,
  infos.ADRESSE3_LIV,
  infos.CODEPOSTAL_LIV,
  infos.VILLE_LIV,
  infos.PAYS_LIV,
  infos.CODE_COMPTA,
  infos.COMPTE,
  cast (null as INTEGER),
  infos.NOM_TIERS,
  infos.PRENOM_TIERS,
  infos.SURNOM_TIERS,
  infos.CODE_T_CIVILITE,
  infos.CODE_T_ENTITE,
  infos.TVA_I_COM_COMPL
  from TA_INFOS_DEVIS infos 
  union   
  select
  cast (null as INTEGER),
  cast (null as INTEGER),
  adresse.ADRESSE1_ADRESSE,
  adresse.ADRESSE2_ADRESSE,
  adresse.ADRESSE3_ADRESSE,
  adresse.CODEPOSTAL_ADRESSE,
  adresse.VILLE_ADRESSE,
  adresse.PAYS_ADRESSE,         
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(5)),
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(8)),
  cast(null as varchar(8)),
  tiers.id_tiers,
  cast(null as varchar(100)),
  cast(null as varchar(100)),
  cast(null as varchar(20)),
  civilite.CODE_T_CIVILITE,
  cast (null as varchar(20)),
  cast (null as varchar(50))
  from ta_adresse adresse 
  left join ta_r_adr rAdr on rAdr.ID_ADRESSE = adresse.ID_ADRESSE  
  left join Ta_tiers tiers on tiers.ID_TIERS = rAdr.ID_TIERS
  left join TA_T_CIVILITE civilite on civilite.id_T_civilite = tiers.id_T_civilite
^


ALTER PROCEDURE EXPORT_EPICEA(
    CPT_ESCOMPTE_DEBIT VARCHAR(8),
    CPT_ESCOMPTE_CREDIT VARCHAR(8),
    FACTURE INTEGER,
    REEXPORT INTEGER)
RETURNS (
    NUM_PIECE INTEGER,
    NUM_LIGNE_PIECE INTEGER,
    TYPE_PIECE VARCHAR(1),
    CODE_PIECE VARCHAR(20),
    DATE_PIECE TIMESTAMP,
    NUM_CPT_LIGNE VARCHAR(8),
    LIBELLE_LIGNE VARCHAR(255),
    MT_DEBIT_LIGNE NUMERIC(18,2),
    MT_CREDIT_LIGNE NUMERIC(18,2),
    QTE_1 NUMERIC(18,2),
    QTE_2 NUMERIC(18,2),
    CODE_TVA VARCHAR(20),
    TAUX_TVA NUMERIC(18,2),
    MT_DEBIT_TVA NUMERIC(18,2),
    MT_CREDIT_TVA NUMERIC(18,2),
    DATE_ECHEANCE TIMESTAMP,
    CPT_COLLECTIF VARCHAR(8),
    NOM_TIERS VARCHAR(100),
    ADRESSE_1_TIERS VARCHAR(100),
    ADRESSE_2_TIERS VARCHAR(100),
    CODE_POSTAL_TIERS VARCHAR(5),
    VILLE_TIERS VARCHAR(100),
    EXIGIBILITE_TVA VARCHAR(1),
    DATE_LIVRAISON_LIGNE TIMESTAMP,
    TTC INTEGER,
    TX_REM_HT_FACTURE NUMERIC(15,2))
AS
DECLARE VARIABLE ID_FACT_COURANT INTEGER;
DECLARE VARIABLE ID_ART INTEGER;
DECLARE VARIABLE ESCOMPTE NUMERIC(15,2);
DECLARE VARIABLE EXPORT_COMPTA INTEGER;
begin
  EXIT;
end
^

/*DROP VIEW V_FACTURE
^*/


CREATE OR ALTER PROCEDURE INFOSDEVIS (
    ID_DOCUMENT_RECUP INTEGER,
    ID_TIERS_RECUP INTEGER,
    LIVRAISON INTEGER)
RETURNS (
    ID_INFOS_DEVIS INTEGER,
    ID_ADRESSE INTEGER,
    ID_DEVIS INTEGER,
    ADRESSE1 VARCHAR(100),
    ADRESSE2 VARCHAR(100),
    ADRESSE3 VARCHAR(100),
    CODEPOSTAL VARCHAR(5),
    VILLE VARCHAR(100),
    PAYS VARCHAR(100),
    ADRESSE1_LIV VARCHAR(100),
    ADRESSE2_LIV VARCHAR(100),
    ADRESSE3_LIV VARCHAR(100),
    CODEPOSTAL_LIV VARCHAR(5),
    VILLE_LIV VARCHAR(100),
    PAYS_LIV VARCHAR(100),
    CODE_COMPTA VARCHAR(7),
    COMPTE VARCHAR(8),
    ID_TIERS INTEGER,
    NOM_TIERS VARCHAR(100),
    PRENOM_TIERS VARCHAR(100),
    SURNOM_TIERS VARCHAR(20),
    CODE_T_CIVILITE VARCHAR(20),
    CODE_T_ENTITE VARCHAR(20),
    TVA_I_COM_COMPL VARCHAR(50),
    CODE_C_PAIEMENT VARCHAR(50),
    LIB_C_PAIEMENT VARCHAR(255),
    REPORT_C_PAIEMENT INTEGER,
    FIN_MOIS_C_PAIEMENT INTEGER)
AS
begin
  EXIT;
end
^


CREATE OR ALTER PROCEDURE CALCUL_TVA_DIRECT (
    MODULE VARCHAR(255),
    ID_DOCUMENT INTEGER,
    TAUXREMISE NUMERIC(15,2),
    TTC INTEGER)
RETURNS (
    ID_DOCUMENT_RECUP INTEGER,
    TAUX_RECUP NUMERIC(15,4),
    CODE_TVA_RECUP VARCHAR(20),
    MT_TVA_RECUP NUMERIC(15,2),
    LIBELLE_RECUP VARCHAR(100),
    VALEURTTC NUMERIC(15,2))
AS
BEGIN
  EXIT;
END
^



CREATE OR ALTER TRIGGER TA_L_DEVIS_TEMP_BU0 FOR TA_L_DEVIS_TEMP
ACTIVE BEFORE UPDATE POSITION 2
as
declare variable typeLigne integer;
begin
TYPELIGNE=0;
select typeL.id_t_ligne from  ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
if (new.id_t_ligne <> typeLigne) then
begin
new.qte_l_DEVIS=null;
new.prix_u_l_DEVIS=null;
new.taux_tva_l_DEVIS=null;
new.code_tva_l_DEVIS=null;
new.mt_ht_l_DEVIS=null;
new.mt_ttc_l_DEVIS=null;
new.rem_tx_l_DEVIS=null;
new.rem_ht_l_DEVIS=null;
end
   new.QUI_MODIF_L_DEVIS = USER;
   new.QUAND_MODIF_L_DEVIS = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^



CREATE OR ALTER TRIGGER TBI_L_DEVIS_TEMP FOR TA_L_DEVIS_TEMP
ACTIVE BEFORE INSERT POSITION 2
as
declare variable typeLigne integer;
begin
TYPELIGNE=0;
select typeL.id_t_ligne from  ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
if (new.id_t_ligne <> typeLigne) then
begin
new.qte_l_DEVIS=null;
new.prix_u_l_DEVIS=null;
new.taux_tva_l_DEVIS=null;
new.code_tva_l_DEVIS=null;
new.mt_ht_l_DEVIS=null;
new.mt_ttc_l_DEVIS=null;
new.rem_tx_l_DEVIS=null;
new.rem_ht_l_DEVIS=null;
end
   If (New.ID_L_DEVIS  is null) Then
      New.ID_L_DEVIS  = GEN_ID(NUM_ID_L_DEVIS,1);
   New.QUI_CREE_L_DEVIS  = USER;
   New.QUAND_CREE_L_DEVIS = 'NOW';
   New.QUI_MODIF_L_DEVIS = USER;
   New.QUAND_MODIF_L_DEVIS = 'NOW';
   new.IP_ACCES=current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBIID_ARTICLE_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
declare variable TYPELIGNE integer;
begin
  /* E_XAKID_ARTICLE */
  select typeL.id_t_ligne from ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
   if (NEW.ID_ARTICLE is not null and new.id_t_ligne =:typeligne ) then
       begin
     select count(*) from TA_ARTICLE
     where ID_ARTICLE= NEW.ID_ARTICLE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ARTICLE;
       end   
end
^



CREATE OR ALTER TRIGGER TBIID_T_LIGNE_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_LIGNE */
   if (NEW.ID_T_LIGNE is not null) then
       begin
       select count(*) from TA_T_LIGNE
       where ID_T_LIGNE= NEW.ID_T_LIGNE
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_T_LIGNE;
       end   
end
^



CREATE OR ALTER TRIGGER TBI_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE INSERT POSITION 2
as
begin
   If (New.ID_L_DEVIS  is null) Then
      New.ID_L_DEVIS  = GEN_ID(NUM_ID_L_DEVIS,1);
   New.QUI_CREE_L_DEVIS  = USER;
   New.QUAND_CREE_L_DEVIS = 'NOW';
   New.QUI_MODIF_L_DEVIS = USER;
   New.QUAND_MODIF_L_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^



CREATE OR ALTER TRIGGER TBUID_ARTICLE_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
declare variable typeligne integer;
begin
  /* E_XAKID_ARTICLE */
  select typeL.id_t_ligne from ta_t_ligne typeL where typeL.code_t_ligne = 'H' into :typeligne;
   if ((OLD.ID_ARTICLE <> NEW.ID_ARTICLE) and new.id_t_ligne =:typeligne ) then
   begin
     select count(*) from TA_ARTICLE
     where ID_ARTICLE = NEW.ID_ARTICLE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ARTICLE;
   end
end
^



CREATE OR ALTER TRIGGER TBUID_L_DEVIS_ETRANGER FOR TA_L_DEVIS
ACTIVE AFTER DELETE POSITION 1
as
begin
delete from TA_R_DOCUMENT where old.id_DEVIS = id_DEVIS;
end
^



CREATE OR ALTER TRIGGER TBUID_T_LIGNE_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_LIGNE */
   if ((OLD.ID_T_LIGNE <> NEW.ID_T_LIGNE)) then
   begin
     select count(*) from TA_T_LIGNE
     where ID_T_LIGNE = NEW.ID_T_LIGNE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_T_LIGNE;
   end
end
^



CREATE OR ALTER TRIGGER TBU_L_DEVIS FOR TA_L_DEVIS
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   new.QUI_MODIF_L_DEVIS = USER;
   new.QUAND_MODIF_L_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBI_TA_INFOS_DEVIS FOR TA_INFOS_DEVIS
ACTIVE BEFORE INSERT POSITION 0
as
begin
   If (New.ID_INFOS_DEVIS is null) Then
      New.ID_INFOS_DEVIS = GEN_ID(NUM_ID_INFOS_DEVIS,1);
   New.QUI_CREE_INFOS_DEVIS = USER;
   new.QUAND_CREE_INFOS_DEVIS = 'NOW';
   new.QUI_MODIF_INFOS_DEVIS = USER;
   new.QUAND_MODIF_INFOS_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^



CREATE OR ALTER TRIGGER TBU_TA_INFOS_DEVIS FOR TA_INFOS_DEVIS
ACTIVE BEFORE UPDATE POSITION 0
as
begin
   new.QUI_MODIF_INFOS_DEVIS = USER;
   new.QUAND_MODIF_INFOS_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^



CREATE OR ALTER TRIGGER TA_DEVIS_AI0 FOR TA_DEVIS
ACTIVE AFTER INSERT POSITION 0
AS
begin
execute procedure enregistre_lignes_devis(new.id_devis,new.ttc);
end
^


CREATE OR ALTER TRIGGER TA_DEVIS_AIU0 FOR TA_DEVIS
ACTIVE AFTER INSERT OR UPDATE POSITION 0
AS
begin
  execute procedure annule_modification('ta_devis','code_devis',new.code_devis);
end
^



CREATE OR ALTER TRIGGER TA_DEVIS_AU0 FOR TA_DEVIS
INACTIVE AFTER UPDATE POSITION 0
AS
begin
execute procedure maj_lignes_devis(old.id_devis,new.ttc);
end
^


CREATE OR ALTER TRIGGER TBDID_DEVIS_ETRANGER FOR TA_DEVIS
ACTIVE AFTER DELETE POSITION 1
as
begin
  delete from ta_l_devis where id_devis = old.id_devis;
  delete from TA_COM_DOC where ID_DOCUMENT = old.ID_devis;
  delete from ta_l_devis_temp where id_devis = old.id_devis;
  delete from ta_infos_devis where id_devis = old.id_devis;
end
^


CREATE OR ALTER TRIGGER TBIID_ADRESSE_DEVIS FOR TA_DEVIS
INACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE */
   if (NEW.ID_ADRESSE is not null) then
       begin
       select count(*) from TA_ADRESSE
       where ID_ADRESSE = NEW.ID_ADRESSE
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_ADRESSE;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_ADRESSE_LIV_DEVIS FOR TA_DEVIS
INACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE_L */
   if (NEW.ID_ADRESSE_LIV is not null) then
       begin
       select count(*) from TA_ADRESSE
       where ID_ADRESSE= NEW.ID_ADRESSE_LIV
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_ADRESSE_L;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_TIERS_DEVIS FOR TA_DEVIS
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_TIERS */
   if (NEW.ID_TIERS is not null) then
       begin
       select count(*) from TA_TIERS
       where ID_TIERS= NEW.ID_TIERS
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_TIERS;
       end   
end
^


CREATE OR ALTER TRIGGER TBIID_T_PAIEMENT_DEVIS FOR TA_DEVIS
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_PAIEMENT */
   if (NEW.ID_T_PAIEMENT is not null) then
       begin
       select count(*) from TA_T_PAIEMENT
       where ID_T_PAIEMENT= NEW.ID_T_PAIEMENT
       into :numrows;
       if (numrows = 0) then
          exception E_XAKID_T_PAIEMENT;
       end   
end
^

CREATE OR ALTER TRIGGER TBI_DEVIS FOR TA_DEVIS
ACTIVE BEFORE INSERT POSITION 2
as
begin
   If (New.ID_devis  is null) Then
      New.ID_devis  = GEN_ID(num_id_devis,1);
   New.CODE_devis = Upper(New.CODE_devis);
   New.QUI_CREE_DEVIS  = USER;
   New.QUAND_CREE_DEVIS = 'NOW';
   New.QUI_MODIF_DEVIS = USER;
   New.QUAND_MODIF_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBI_XAKCODE_DEVIS FOR TA_DEVIS
ACTIVE BEFORE INSERT POSITION 0
as
DECLARE variable numrows integer;
begin
  /* XAKCODE_DEVIS */
   select count(*) from TA_DEVIS
   where CODE_DEVIS = NEW.CODE_DEVIS
   into :numrows;
   if (numrows > 0) then
      exception E_XAKCODE_DEVIS;
end
^


CREATE OR ALTER TRIGGER TBUID_ADRESSE_DEVIS FOR TA_DEVIS
INACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* XAKID_ADRESSE */
   if ((OLD.ID_ADRESSE <> NEW.ID_ADRESSE)) then
   begin
     select count(*) from TA_ADRESSE
     where ID_ADRESSE = NEW.ID_ADRESSE
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ADRESSE;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_ADRESSE_LIV_DEVIS FOR TA_DEVIS
INACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_ADRESSE_L */
   if ((OLD.ID_ADRESSE_LIV <> NEW.ID_ADRESSE_LIV)) then
   begin
     select count(*) from TA_ADRESSE
     where ID_ADRESSE = NEW.ID_ADRESSE_LIV
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_ADRESSE_L;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_TIERS_DEVIS FOR TA_DEVIS
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_TIERS */
   if ((OLD.ID_TIERS <> NEW.ID_TIERS)) then
   begin
     select count(*) from TA_TIERS
     where ID_TIERS = NEW.ID_TIERS
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_TIERS;
   end
end
^


CREATE OR ALTER TRIGGER TBUID_T_PAIEMENT_DEVIS FOR TA_DEVIS
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKID_T_PAIEMENT */
   if ((OLD.ID_T_PAIEMENT <> NEW.ID_T_PAIEMENT)) then
   begin
     select count(*) from TA_T_PAIEMENT
     where ID_T_PAIEMENT = NEW.ID_T_PAIEMENT
     into :numrows;
     if (numrows = 0) then
        exception E_XAKID_T_PAIEMENT;
   end
end
^


CREATE OR ALTER TRIGGER TBU_DEVIS FOR TA_DEVIS
ACTIVE BEFORE UPDATE POSITION 2
as
begin
   New.CODE_DEVIS = Upper(New.CODE_DEVIS);
   new.QUI_MODIF_DEVIS = USER;
   new.QUAND_MODIF_DEVIS = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


CREATE OR ALTER TRIGGER TBU_XAKCODE_DEVIS FOR TA_DEVIS
ACTIVE BEFORE UPDATE POSITION 0
as
DECLARE variable numrows integer;
begin
  /* XAKCODE_DEVIS */
   if ((OLD.CODE_DEVIS <> NEW.CODE_DEVIS)) then
   begin
   select count(*) from TA_DEVIS
   where CODE_DEVIS = NEW.CODE_DEVIS
   into :numrows;
   if (numrows > 0) then
      exception E_XAKCODE_DEVIS;
   end
end
^

RECREATE VIEW V_L_DEVIS_TEMP(
    ID_L_DEVIS,
    ID_DEVIS,
    ID_T_LIGNE,
    ID_ARTICLE,
    NUM_LIGNE_L_DEVIS,
    CODE_ARTICLE,
    LIB_L_DEVIS,
    QTE_L_DEVIS,
    U1_L_DEVIS,
    U2_L_DEVIS,
    PRIX_U_L_DEVIS,
    TAUX_TVA_L_DEVIS,
    COMPTE_L_DEVIS,
    CODE_TVA_L_DEVIS,
    CODE_T_TVA_L_DEVIS,
    MT_HT_L_DEVIS,
    MT_TTC_L_DEVIS,
    REM_TX_L_DEVIS,
    REM_HT_L_DEVIS,
    IP_ACCES)
AS
select
  LDEVIS.ID_L_DEVIS,
  LDEVIS.ID_DEVIS,
  LDEVIS.ID_T_LIGNE,
  LDEVIS.ID_ARTICLE,
  LDEVIS.NUM_LIGNE_L_DEVIS,
  article.CODE_ARTICLE,
  LDEVIS.LIB_L_DEVIS,
  LDEVIS.QTE_L_DEVIS,
  LDEVIS.U1_L_DEVIS,
  LDEVIS.U2_L_DEVIS,
  LDEVIS.PRIX_U_L_DEVIS,
  LDEVIS.TAUX_TVA_L_DEVIS,
  LDEVIS.COMPTE_L_DEVIS,
  LDEVIS.CODE_TVA_L_DEVIS,
  LDEVIS.CODE_T_TVA_L_DEVIS,
  LDEVIS.MT_HT_L_DEVIS,
  LDEVIS.MT_TTC_L_DEVIS,
  LDEVIS.REM_TX_L_DEVIS,
  LDEVIS.REM_HT_L_DEVIS,
    LDEVIS.IP_ACCES
  from TA_L_DEVIS_TEMP LDEVIS 
  left join TA_ARTICLE article on (article.id_article = LDEVIS.id_article)
^

RECREATE VIEW V_L_DEVIS(
    ID_L_DEVIS,
    ID_DEVIS,
    ID_T_LIGNE,
    ID_ARTICLE,
    NUM_LIGNE_L_DEVIS,
    CODE_ARTICLE,
    LIB_L_DEVIS,
    QTE_L_DEVIS,
    U1_L_DEVIS,
    U2_L_DEVIS,
    PRIX_U_L_DEVIS,
    TAUX_TVA_L_DEVIS,
    COMPTE_L_DEVIS,
    CODE_TVA_L_DEVIS,
    CODE_T_TVA_L_DEVIS,
    MT_HT_L_DEVIS,
    MT_TTC_L_DEVIS,
    REM_TX_L_DEVIS,
    REM_HT_L_DEVIS,
    IP_ACCES)
AS
select
  LDEVIS.ID_L_DEVIS,
  LDEVIS.ID_DEVIS,
  LDEVIS.ID_T_LIGNE,
  LDEVIS.ID_ARTICLE,
  LDEVIS.NUM_LIGNE_L_DEVIS,
  article.CODE_ARTICLE,
  LDEVIS.LIB_L_DEVIS,
  LDEVIS.QTE_L_DEVIS,
  LDEVIS.U1_L_DEVIS,
  LDEVIS.U2_L_DEVIS,
  LDEVIS.PRIX_U_L_DEVIS,
  LDEVIS.TAUX_TVA_L_DEVIS,
  LDEVIS.COMPTE_L_DEVIS,
  LDEVIS.CODE_TVA_L_DEVIS,
  LDEVIS.CODE_T_TVA_L_DEVIS,
  LDEVIS.MT_HT_L_DEVIS,
  LDEVIS.MT_TTC_L_DEVIS,
  LDEVIS.REM_TX_L_DEVIS,
  LDEVIS.REM_HT_L_DEVIS,
    LDEVIS.IP_ACCES
  from TA_L_DEVIS LDEVIS 
  left join TA_ARTICLE article on (article.id_article = LDEVIS.id_article)
^


RECREATE VIEW V_BONLIV(
    ID_BONLIV,
    CODE_BONLIV,
    DATE_BONLIV,
    DATE_LIV_BONLIV,
    LIBELLE_BONLIV,
    ID_ADRESSE,
    ADRESSE1_ADRESSE,
    ADRESSE2_ADRESSE,
    ADRESSE3_ADRESSE,
    CODEPOSTAL_ADRESSE,
    VILLE_ADRESSE,
    PAYS_ADRESSE,
    ID_ADRESSE_LIV,
    ADRESSE1_ADRESSELIV,
    ADRESSE2_ADRESSELIV,
    ADRESSE3_ADRESSELIV,
    CODEPOSTAL_ADRESSELIV,
    VILLE_ADRESSELIV,
    PAYS_LIV,
    ID_TIERS,
    CODE_TIERS,
    NOM_TIERS,
    PRENOM_TIERS,
    SURNOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    ID_T_PAIEMENT,
    CODE_T_PAIEMENT,
    ID_C_PAIEMENT,
    REM_HT_BONLIV,
    TX_REM_HT_BONLIV,
    REM_TTC_BONLIV,
    TX_REM_TTC_BONLIV,
    NB_E_BONLIV,
    MT_TTC_CALC,
    MT_HT_CALC,
    MT_TVA_CALC,
    NET_TTC_CALC,
    NET_HT_CALC,
    NET_TVA_CALC,
    IP_ACCES,
    TTC,
    COMMENTAIRE)
AS
select
  BONLIV.ID_BONLIV,
  BONLIV.CODE_BONLIV,
  BONLIV.DATE_BONLIV,
  BONLIV.date_liv_BONLIV,
  BONLIV.LIBELLE_BONLIV,
  BONLIV.ID_ADRESSE,
  infos.adresse1,
  infos.adresse2,
  infos.adresse3,
  infos.codepostal,
  infos.ville,
  infos.pays,
  BONLIV.ID_ADRESSE_LIV,
  infos.adresse1_liv,
  infos.adresse2_liv,
  infos.adresse3_liv,
  infos.codepostal_liv,
  infos.ville_liv,
  infos.PAYS_LIV,
  BONLIV.ID_TIERS,
  Tiers.code_tiers,
  infos.NOM_TIERS,
  infos.PRENOM_TIERS,
  infos.SURNOM_TIERS,
  infos.CODE_COMPTA,
  infos.COMPTE,
  BONLIV.ID_T_PAIEMENT,
  TPaiement.code_t_paiement,
  CPaiement.id_c_paiement,
  BONLIV.REM_HT_BONLIV,
  BONLIV.TX_REM_HT_BONLIV,
  BONLIV.REM_TTC_BONLIV,
  BONLIV.TX_REM_TTC_BONLIV,
  BONLIV.nb_e_BONLIV,
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  BONLIV.IP_ACCES,
  BONLIV.TTC ,
  bonliv.commentaire
  from TA_BONLIV BONLIV
  left join ta_infos_BONLIV infos on (infos.ID_INFOS_BONLIV = BONLIV.id_adresse )
  left join ta_tiers Tiers on (Tiers.id_tiers = BONLIV.id_tiers)
  left join ta_t_paiement TPaiement on (TPaiement.id_t_paiement = BONLIV.id_t_paiement)
  left join ta_c_paiement CPaiement on (CPaiement.id_c_paiement = BONLIV.id_c_paiement)
^


RECREATE VIEW V2_DEVIS(
    ID_DEVIS,
    CODE_DEVIS,
    DATE_DEVIS,
    DATE_ECH_DEVIS,
    DATE_LIV_DEVIS,
    LIBELLE_DEVIS,
    CODE_TIERS,
    NOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    TTC,
    NB_E_DEVIS,
    EXPORT,
    COMMENTAIRE)
AS
select
Devis.ID_DEVIS,
Devis.CODE_DEVIS,
Devis.DATE_DEVIS,
Devis.DATE_ECH_DEVIS,
Devis.DATE_LIV_DEVIS,
Devis.LIBELLE_DEVIS,
Tiers.code_tiers,
infos.NOM_TIERS,
infos.CODE_COMPTA,
infos.COMPTE,
Devis.ttc,
Devis.nb_e_DEVIS,
Devis.export,
Devis.COMMENTAIRE


from TA_DEVIS Devis
left join ta_tiers Tiers on (Tiers.id_tiers = Devis.id_tiers)
left join ta_infos_devis infos on (infos.id_devis = devis.id_devis)
^


RECREATE VIEW V_DEVIS(
    ID_DEVIS,
    CODE_DEVIS,
    DATE_DEVIS,
    DATE_ECH_DEVIS,
    DATE_LIV_DEVIS,
    LIBELLE_DEVIS,
    ID_ADRESSE,
    ADRESSE1_ADRESSE,
    ADRESSE2_ADRESSE,
    ADRESSE3_ADRESSE,
    CODEPOSTAL_ADRESSE,
    VILLE_ADRESSE,
    PAYS_ADRESSE,
    ID_ADRESSE_LIV,
    ADRESSE1_ADRESSELIV,
    ADRESSE2_ADRESSELIV,
    ADRESSE3_ADRESSELIV,
    CODEPOSTAL_ADRESSELIV,
    VILLE_ADRESSELIV,
    PAYS_LIV,
    ID_TIERS,
    CODE_TIERS,
    NOM_TIERS,
    PRENOM_TIERS,
    SURNOM_TIERS,
    CODE_COMPTA,
    COMPTE,
    ID_T_PAIEMENT,
    CODE_T_PAIEMENT,
    ID_C_PAIEMENT,
    REM_HT_DEVIS,
    TX_REM_HT_DEVIS,
    REM_TTC_DEVIS,
    TX_REM_TTC_DEVIS,
    NB_E_DEVIS,
    MT_TTC_CALC,
    MT_HT_CALC,
    MT_TVA_CALC,
    NET_TTC_CALC,
    NET_HT_CALC,
    NET_TVA_CALC,
    IP_ACCES,
    TTC,
    COMMENTAIRE)
AS
select
  devis.ID_DEVIS,
  devis.CODE_DEVIS,
  devis.DATE_DEVIS,
  devis.DATE_ECH_DEVIS,
  devis.date_liv_devis,
  devis.LIBELLE_DEVIS,
  devis.ID_ADRESSE,
  infos.adresse1,
  infos.adresse2,
  infos.adresse3,
  infos.codepostal,
  infos.ville,
  infos.pays,
  devis.ID_ADRESSE_LIV,
  infos.adresse1_liv,
  infos.adresse2_liv,
  infos.adresse3_liv,
  infos.codepostal_liv,
  infos.ville_liv,
  infos.PAYS_LIV,
  devis.ID_TIERS,
  Tiers.code_tiers,
  infos.NOM_TIERS,
  infos.PRENOM_TIERS,
  infos.SURNOM_TIERS,
  infos.CODE_COMPTA,
  infos.COMPTE,
  devis.ID_T_PAIEMENT,
  TPaiement.code_t_paiement,
  CPaiement.id_c_paiement,
  devis.REM_HT_DEVIS,
  devis.TX_REM_HT_DEVIS,
  devis.REM_TTC_DEVIS,
  devis.TX_REM_TTC_DEVIS,
  devis.nb_e_devis,
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  cast(0 as double precision),
  devis.IP_ACCES,
  devis.TTC,
  devis.COMMENTAIRE
  from TA_DEVIS devis
  left join ta_infos_DEVIS infos on (infos.ID_INFOS_DEVIS = devis.id_adresse )
  left join ta_tiers Tiers on (Tiers.id_tiers = devis.id_tiers)
  left join ta_t_paiement TPaiement on (TPaiement.id_t_paiement = devis.id_t_paiement)
  left join ta_c_paiement CPaiement on (CPaiement.id_c_paiement = devis.id_c_paiement)
^
